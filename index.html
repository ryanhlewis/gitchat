<html lang="en" background="#191919">

<head>
    <title>gitchat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, interactive-widget=resizes-content">
    <meta name="theme-color" content="#23272a">

</head>


<style>
::-webkit-scrollbar {
    height: 1rem;
    width: .5rem;
}
::-webkit-scrollbar-thumb {
    --tw-border-opacity: 1;
    background-color: rgba(217,217,227,.8);
    border-color: rgba(255,255,255,var(--tw-border-opacity));
    border-radius: 9999px;
    border-width: 1px;
}
::-webkit-scrollbar-track {
    background-color: transparent;
    border-radius: 9999px;
}

    html {
        -webkit-text-size-adjust: 100%;
        -webkit-font-feature-settings: normal;
        font-feature-settings: normal;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, Helvetica Neue, Arial, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
        font-variation-settings: normal;
        line-height: 1.5;
        tab-size: 4;
    }

    body {
        margin: 0;
        padding: 0;
        background-color: #2c2f33;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, Helvetica Neue, Arial, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
        color:white;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .server {
        padding: 10px;
        color: #fff;
        cursor: pointer;
    }

    .server:hover {
        background-color: #36393f;
    }

    .server-selected {
        background-color: #36393f;
    }


    .button-style {
        background-color: transparent;
        margin-left: 10px;
        width: 40px;
        height: 40px;
        border: 0;
        border-radius: 50%;
        color: #808080;
        fill: #808080;
        transition: color 0.3s ease, fill 0.3s ease;
    }

    .button-style:hover {
        color: #ffffff;
        fill: #ffffff;
        cursor: pointer;
    }

    .search-style {
        margin-left: 10px;
        width: calc(200px);
        padding: 10px;
        border: 0;
        border-radius: 15px;
        background-color: #2c2f33;
        color: #fff;
    }


    #search-chat {
        display: block;
    }

    /* screens below 870px */
    @media (max-width: 870px) {
        #search-chat {
            display: none;
        }
    }

    @media (max-width: 600px) {
        #chatwindow {
            width: calc(100% - 322px);
        }
    }


    </style>

<body>

        <div id="nonLogin" style="display:none">


<style>
    .logo-button {
    min-width: 42px;
    min-height: 42px;
    border-radius: 40%;
    background-color: #2F3136;
}

.add-server-icon {
    min-width: 42px;
    min-height: 42px;
    background-color: #2F3136;
    border-radius: 30%;
}

.add-server-icon svg {
    width: 32px;
    height: 32px;
    margin-left: 5px;
    margin-top: 5px;
    fill: greenyellow;
}

</style>

            <div id="app">

                <div id="leftsidebar">

                <!-- Server sidebar -->
                <div style="width: 62px;height: 100%;float: left;background-color: #171a1c;overflow-x: hidden;">
                    <div id="server-list-left" style="width: 100%;/* height: calc(100% - 115px); */overflow-y: auto;overflow-x: hidden;">
                    
                    <div class="friend"><img class="friend-avatar logo-button" src="icons/small.svg">
                    </div>
                    
                    <div class="friend" id="addServer">
                    <div class="friend-avatar add-server-icon">
                        <svg width="42px" height="42px" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/>
                        </svg>
                    </div>
                    </div>
                    
                    </div>
                </div>


                <style>
                    .overlay {
    display: none;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
}

.popup {
    width: 500px;
    height: 400px;
    background-color: #23272a;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 10px;
    overflow: hidden;
}

.popup-header {
    width: 100%;
    height: 50px;
    background-color: #23272a;
    padding: 10px;
}

.popup-title {
    margin: 0;
    display: inline-flex;
    margin-top: 8px;
    margin-left: 10px;
}

.popup-close-button {
    float: right;
    margin-top: 8px;
    margin-right: 20px;
    padding: 10px;
    border: 0;
    border-radius: 50%;
    color: #fff;
}

.popup-close-image {
    height:16px;
}

.popup-content {
    width: 100%;
    height: calc(100% - 70px);
    overflow-y: auto;
    background-color: #2c2f33;
    text-align: center;
}

.server-icon-input {
    padding: 55px;
}

.server-name-input {
    width: calc(100% - 165px);
    height: 50px;
    padding: 10px;
    border: 0;
    border-radius: 15px;
    background-color: #202225;
    color: #fff;
    margin-top: 80px;
}

.popup-submit-button {
    width: calc(100% - 265px);
    height: 50px;
    padding: 10px;
    border: 0;
    border-radius: 15px;
    background-color: #202225;
    color: #fff;
    margin-top: -50px;
}


/* New styles*/

#upload-container {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    border: 2px dashed #ccc;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f8f8;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
}

#upload-container:hover {
    border-color: #888;
}

.server-icon-input {
    display: none;
}

#preview {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    background: #fff;
    position: absolute;
}

#upload-text {
    position: absolute;
    color: #888;
    font-size: 16px;
    text-align: center;
}


                </style>

                <div id="overlay" class="overlay">
                    <div id="popup" class="popup">
                      <div class="popup-header">
                        <h2 class="popup-title">Create a Server</h2>
                        <button id="popup-close-button" class="popup-close-button">
                          <img src="icons/search.svg" draggable="false" class="popup-close-image">
                        </button>
                      </div>
                      <div class="popup-content">
                        <!-- <input id="serverIcon" class="server-icon-input" type="file"> -->
                        <div id="upload-container" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
                            <input id="serverIcon" class="server-icon-input" type="file" onchange="previewFile()">
                            <div id="preview"></div>
                            <div id="upload-text">Upload Server Logo</div>
                        </div>
                        
                        <input id="serverName" class="server-name-input" placeholder="Username's Server" type="text">
                      </div>
                      <button id="popup-submit-button" class="popup-submit-button">Submit</button>
                    </div>
                  </div>
                  


                <script>

// document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('#addServer').addEventListener('click', function() {
        // Create the overlay
        var overlay = document.querySelector('#overlay');
        overlay.style.display = 'block';

    });

        // Close the popup
        document.querySelector('#popup-close-button').addEventListener('click', function() {
            var overlay = document.querySelector('#overlay');

            overlay.style.display = 'none';
        });

        // Submit server details
        document.querySelector('#popup-submit-button').addEventListener('click', function() {
            addServer(document.querySelector('#serverName').value, document.querySelector('#serverIcon').files[0]);
            var overlay = document.querySelector('#overlay');
            overlay.style.display = 'none';
        });
// });


function addServer(serverName, serverIcon) {
    // Create a new friend div
    var friendDiv = document.createElement('div');
    friendDiv.classList.add('friend');

    // Create the friend avatar
    var friendAvatar = document.createElement('img');
    friendAvatar.classList.add('friend-avatar');
    // Make min-height and min-width 42px
    friendAvatar.style.minHeight = '42px';
    friendAvatar.style.minWidth = '42px';

    if (serverIcon) {
        // Convert the file to a data URL and set as the source
        var reader = new FileReader();
        reader.onload = function(e) {

            // Convert to 200x200
            var canvas = document.createElement("canvas");
            var ctx = canvas.getContext("2d");
            var img = new Image();
            img.src = e.target.result;
            ctx.drawImage(img, 0, 0, 200, 200);
            // make sure the image has no transparent parts from being resized
            ctx.globalCompositeOperation = "destination-over";
            ctx.fillStyle = "#202225";
            ctx.fillRect(0, 0, canvas.width, canvas.height);


            var dataURL = canvas.toDataURL("image/png");
            

            friendAvatar.src = dataURL;


            //friendAvatar.src = e.target.result;
        };
        reader.readAsDataURL(serverIcon);
    } else {
        // Set a random color as the background
        // change the element type to div
        friendAvatar = document.createElement('div');
        friendAvatar.classList.add('friend-avatar');
        friendAvatar.style.minHeight = '42px';
        friendAvatar.style.minWidth = '42px';
        friendAvatar.style.backgroundColor = getRandomColor();
    }
    friendDiv.appendChild(friendAvatar);

    // Create the friend name div
    var friendName = document.createElement('div');
    friendName.classList.add('friend-name');
    friendName.textContent = serverName;
    friendDiv.appendChild(friendName);

    // Insert another div called true-friend-name with the actual name, but hidden
    var trueFriendName = document.createElement('div');
    trueFriendName.classList.add('true-friend-name');
    trueFriendName.style.display = 'none';
    trueFriendName.textContent = serverName;
    friendDiv.appendChild(trueFriendName);

    // Insert the new friend div before the add server button
    document.querySelector('#server-list-left').insertBefore(friendDiv, document.querySelector('#addServer'));
}

function getRandomColor() {
    var letters = '0123456789ABCDEF';
    var color = '#';
    for (var i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}


/* New script */ 

function previewFile() {
    var preview = document.querySelector('#preview');
    var file    = document.querySelector('.server-icon-input').files[0];
    var reader  = new FileReader();

    reader.onloadend = function () {
        preview.style.background = 'url("' + reader.result + '") no-repeat center';
        preview.style.backgroundSize = 'cover';
    }

    if (file) {
        reader.readAsDataURL(file);
    } else {
        preview.style.background = "";
    }
}

function dropHandler(ev) {
    ev.preventDefault();
    if (ev.dataTransfer.items) {
        for (var i = 0; i < ev.dataTransfer.items.length; i++) {
            if (ev.dataTransfer.items[i].kind === 'file') {
                var file = ev.dataTransfer.items[i].getAsFile();
                document.querySelector('.server-icon-input').files = file;
                previewFile();
            }
        }
    } 
}

function dragOverHandler(ev) {
    ev.preventDefault();
}


                </script>


                <!-- make the server-list again, but now with a user profile at the very bottom, with username and avatar from localStorage -->
                <div style="width: 260px; height: 100%; float: left; background-color: #202225;">
                    <div style="width: 260px; height: 50px; float: left; background-color: #23272a; display: flex; align-items: center;">
                        <input placeholder="Find new friends.." type="text" id="search" style="width: calc(100% - 100px); margin-left: 25px; padding: 10px; border: 0; border-radius: 15px; background-color: #2c2f33; color: #fff;">
                        <button id="search-button" style="width: 35px; height: 35px; margin-left:5px; border: 0; border-radius: 50%; color: #fff;">
                            <img src="icons/search.svg" draggable="false" style="height:16px;">
                        </button>
                    </div>
                    <div id="server-list" style="width: 100%; height: calc(100% - 115px); overflow-y: auto;"></div>

                    <style>
                        .container {
  width: 100%;
  height: 100px;
  background-color: #23272a;
  padding: 10px;
  display: flex;
  align-items: center;
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: #2c2f33;
  background-size: cover;
  background-position: center;
  flex-shrink: 0;
}

.user-details {
  height: 100%;
  width: 70%;
  padding: 10px;
  display: flex;
  align-items: center;
}

.username-prefix,
.username {
  font-size: 15px;
  font-weight: bold;
  color: #fff;
}

.username {
  /* margin-left: 10px; */
  color:white;
}

.sideusername {
    flex-grow: 1;
    width: fit-content;
    display: inline-flex;
    font-size: 15px;
    font-weight: bold;
    color: white;
    pointer-events: none;
}

.logout-btn {
  width: 40px;
  height: 40px;
  margin-top: -27px;
  margin-right: -20px;
  padding: 10px;
  border: 0;
  border-radius: 50%;
  color: #fff;
  margin-left: auto; /* Push button to the right */
}

.logout-icon {
  height: 31px;
  margin-left: -6px;
  margin-top: -5px;
}


/* Rest of the CSS remains the same as previous */
.avatar {
  width: 40px;
  height: 40px;
  border-radius: 20px;
}

.grow {
  flex-grow: 1;
}

.text-ellipsis {
  overflow: hidden;
  text-overflow: ellipsis;
}

.text-left {
    font-family: inherit;
  text-align: left;
}

.text-gray-500 {
  color: #a0aec0;
}

.w-full {
  width: 100%;
}

.flex {
  display: flex;
}

.items-center {
  align-items: center;
}

.gap-2.5 {
  gap: 10px;
}

.rounded-md {
  border-radius: 6px;
}

.px-3 {
  padding-left: 12px;
  padding-right: 12px;
}

.py-2 {
  padding-top: 8px;
  padding-bottom: 8px;
}

.transition-colors {
  transition-property: background-color, border-color, color, fill, stroke;
  transition-duration: 200ms;
  transition-timing-function: ease-in-out;
  background-color: transparent;
  border: none;
  color: white;
}

.hover\:bg-gray-800:hover {
  background-color: #4b535d90; 
  cursor: pointer;
}

.group-hover\:bg-gray-800.group:hover {
  background-color: #4b535d90; 
  cursor: pointer;
}

.h-4 {
  height: 16px;
}

.w-4 {
  width: 16px;
}

.flex-shrink-0 {
  flex-shrink: 0;
}

.bg-gray-950 {
  background-color: #23272a; 
}

.hover\:bg-gray-700:hover {
  background-color: #282c34;
}

.pt-2 {
    padding-top: .5rem;
}
.border-white\/20 {
    border-color: hsla(0,0%,100%,.2);
}

.border-t {
    background-color: #23272a;
    border-top-width: 1px;
    padding: 12px;
}
                    </style>
  
                       <div class="border-t border-white/20 pt-2 empty:hidden">
                       <div class="group relative">
                        <button onclick="toggleMenu()" class="flex w-full items-center gap-2.5 rounded-md px-3 py-3 text-sm transition-colors duration-200 hover:bg-gray-800 group-hover:bg-gray-800" id="headlessui-menu-button" type="button" aria-haspopup="true" aria-expanded="false">
                          <div id="avatar" class="avatar"></div>
                          <div id="username" class="grow overflow-hidden text-ellipsis whitespace-nowrap text-left text-white">Username</div>
                          <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 flex-shrink-0 text-gray-500">
                            <circle cx="12" cy="12" r="1"></circle>
                            <circle cx="19" cy="12" r="1"></circle>
                            <circle cx="5" cy="12" r="1"></circle>
                          </svg>
                        </button>
                        <div class="absolute bottom-full left-0 z-20 mb-2 w-full overflow-hidden rounded-md bg-gray-950 pb-1.5 pt-1 outline-none opacity-100 translate-y-0" aria-labelledby="headlessui-menu-button" id="headlessui-menu-items" role="menu" tabindex="0">
                          <!-- Drop down menu items go here -->
                          
                          <style>
                            .menucontainer {
                                    position: relative;
                                    display: flex;
                            }
                            .menu {
                            position: absolute;
                            /* bottom: 100%; */
                            left: 0;
                            z-index: 20;
                            margin-bottom: 2px;
                            width: 100%;
                            overflow: hidden;
                            border-radius: 7px;
                            background-color: #1f1f1f;
                            /* padding-bottom: 1.5px; */
                            /* padding-top: 1px; */
                            outline: none;
                            opacity: 100%;
                            transform: translateY(0);
                            display: none; /* Initially hidden */
                            bottom: 60;
                            --tw-bg-opacity: 1;
                                background-color: rgba(5,5,9,var(--tw-bg-opacity));
                            }
                            .menuitem {
                            display: flex;
                            /* padding: 3px; */
                            padding: .70rem;
                            align-items: center;
                            gap: .75rem;
                            transition: color 0.2s;
                            color: white;
                            cursor: pointer;
                            font-size: small;
                            text-decoration: none;
                            }
                            .menuitem:hover {
                            background-color: #303030;
                            }
                            .icon {
                            stroke: currentColor;
                            fill: none;
                            stroke-width: 2;
                            height: 1em;
                            width: 1em;
                            }
                            .separator {
                            margin: 1.5px 0;
                            height: 1px;
                            background-color: rgba(255, 255, 255, 0.2);
                            }
                            /* Button styles */
                            .button {
                            position: fixed;
                            bottom: 10px;
                            left: 10px;
                            }
                            .my-divider {
                                margin-top: 6px;
                                margin-bottom: 6px;
                                height: 1px;
                                background-color: rgba(255, 255, 255, 0.2);
                            }
                            </style>
                            <div class="menucontainer">
                            <div class="menu" id="menu" role="menu" tabindex="0" style="display:none">
                            <nav role="none">
                            <a href="#" class="menuitem" role="menuitem" tabindex="-1">
                            <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                            My profile
                            </a>
                            <a href="#" target="_blank" class="menuitem" role="menuitem" tabindex="-1">
                            <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                            Settings
                            </a>
                            <div class="my-divider" role="none"></div>
                            <a href="#" id="logout" target="_blank" class="menuitem" role="menuitem" tabindex="-1">
                            <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>                            Log out
                            </a>                            
                            <!-- More menu items here -->
                            </nav>
                            </div>
                            </div>
                            <script>
                            function toggleMenu() {
                            var menu = document.getElementById("menu");
                            menu.style.display = menu.style.display === "none" ? "block" : "none";
                            }
                            </script>
                          
                        </div>
                      </div>
                    </div>

                    

                </div>

            </div>


            <div id="centersidebar">
            
            <div class="mobileready">

            <div id="header" style="width: calc(100% - 322px); height: 50px; float: right; background-color: #23272a;">
                <div style="width: calc(100%); height: 50px; background-color: #23272a; display: flex; align-items: center; ">
                    <div style="padding: 10px;">
                        <img id="user-avatar" src="" style="width: 20px; height: 20px; border-radius: 50%; margin-right: 5px; padding: 5px; float: left;" />
                        <!-- <div style="float: left; font-size: 19px; font-weight: bold; color: #fff;"><b id="server-name"></b></div> -->
                        <div style="flex-grow: 1; flex-shrink: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0;"><b id="server-name"></b></div>
                        <div id="true-server-name" style="display:none;"></div>
                        <div id="lastSHA" style="display: none;"></div>
                    </div>
                    <!-- <button id="call-button" style="width: 40px; height: 40px; margin-right:10px; border: 0; border-radius: 50%; color: #ffffff41; background-color: #ffffff41; margin-left: auto;">
                        <img src="CALL_SVG_URL" draggable="false" style="height: 31px; margin-left: -6px; margin-top: -5px;">
                    </button> -->
                    <button id="voice-call-button" class="button-style" onclick="startVoiceCall()" style="margin-left:auto;">
                        <svg style="margin-left:-6px" width="35px" height="35px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="m77.7 63.9l-6.2-5c-2.1-1.7-5.1-1.8-7.3-0.2l-5.9 4.3c-0.8 0.6-1.9 0.5-2.6-0.2l-9.7-8.8-8.9-9.8c-0.7-0.7-0.8-1.8-0.2-2.6l4.3-5.9c1.6-2.2 1.5-5.2-0.2-7.3l-5-6.2c-2.2-2.8-6.4-3-8.9-0.5l-5.4 5.4c-1.2 1.2-1.8 2.9-1.8 4.5 0.7 12.7 6.5 24.8 15 33.3s20.5 14.3 33.3 15c1.7 0.1 3.3-0.6 4.5-1.8l5.4-5.4c2.7-2.4 2.4-6.6-0.4-8.8z"></path></svg>
                    </button>
                    <button id="video-call-button" class="button-style" onclick="startVideoCall()">
                        <svg width="30px" height="30px" viewBox="0 0 1024 1024"   version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M170.666667 256h469.333333c46.933333 0 85.333333 38.4 85.333333 85.333333v341.333334c0 46.933333-38.4 85.333333-85.333333 85.333333H170.666667c-46.933333 0-85.333333-38.4-85.333334-85.333333V341.333333c0-46.933333 38.4-85.333333 85.333334-85.333333z"  /><path d="M938.666667 746.666667l-213.333334-128V405.333333l213.333334-128z"  /></svg>                    </button>
                        <input placeholder="Search Chat.." type="text" id="search-chat" class="search-style">
                    <button id="show-users-button" class="button-style" onclick="showUsers()">
                        <svg width="20px" height="20px" viewBox="0 0 24 24"  xmlns="http://www.w3.org/2000/svg">
                            <path d="M1.5 6.5C1.5 3.46243 3.96243 1 7 1C10.0376 1 12.5 3.46243 12.5 6.5C12.5 9.53757 10.0376 12 7 12C3.96243 12 1.5 9.53757 1.5 6.5Z" />
                            <path d="M14.4999 6.5C14.4999 8.00034 14.0593 9.39779 13.3005 10.57C14.2774 11.4585 15.5754 12 16.9999 12C20.0375 12 22.4999 9.53757 22.4999 6.5C22.4999 3.46243 20.0375 1 16.9999 1C15.5754 1 14.2774 1.54153 13.3005 2.42996C14.0593 3.60221 14.4999 4.99966 14.4999 6.5Z" />
                            <path d="M0 18C0 15.7909 1.79086 14 4 14H10C12.2091 14 14 15.7909 14 18V22C14 22.5523 13.5523 23 13 23H1C0.447716 23 0 22.5523 0 22V18Z" />
                            <path d="M16 18V23H23C23.5522 23 24 22.5523 24 22V18C24 15.7909 22.2091 14 20 14H14.4722C15.4222 15.0615 16 16.4633 16 18Z" />
                        </svg>
                    </button>
                </div>
            </div>

            <script>
 
function startVoiceCall() {
    console.log("Voice call started!");
    // Place your voice call logic here

    var video = document.createElement("iframe");
    video.src = "https://peercalls.com/call/tSCs5VW9FsyPytnIa4j7L7";
    video.allow = "camera *;microphone *; display-capture *; fullscreen *;";
    video.width = "100%";
    video.height = "100%";
    video.style.border = "0";

    document.getElementById("call").style.display = "block";
    document.getElementById("message-list").style.height = "calc(100% - 490px)";
    document.getElementById("call").appendChild(video);

}

function startVideoCall() {
    console.log("Video call started!");

    var video = document.createElement("iframe");
    video.src = "https://peercalls.com/call/tSCs5VW9FsyPytnIa4j7L7";
    video.allow = "camera *;microphone *; display-capture *; fullscreen *;";
    video.width = "100%";
    video.height = "100%";
    video.style.border = "0";

    document.getElementById("call").style.display = "block";
    document.getElementById("message-list").style.height = "calc(100% - 490px)";
    document.getElementById("call").appendChild(video);
}

function showUsers() {
    if (document.getElementById("chatwindow").style.width == "calc(100% - 582px)") {
        document.getElementById("chatwindow").style.width = "calc(100% - 322px)";
    } else {
        document.getElementById("chatwindow").style.width = "calc(100% - 582px)";
    }
}

            </script>


            
                <div id="chatwindow" style="width: calc(100% - 582px); height: calc(100% - 50px); float: left; background-color: #2F3136;">
                    <div id="main"
                    ondrop="dropHandler(event);"
                    ondragover="dragOverHandler(event);" style="width: 100%; height: 100%;">

                        <!-- make a video / voice call menu above the chat, set to display:none, and dynmaically resizes chat down when active -->
                        <div id="call" style="/*width: 100%;*/ height: 355px; background-color: #212020; padding: 10px; display: none; overflow: hidden; border: none;"></div>

                        <div id="message-list" style="width: 100%; height: calc(100% - 65px); overflow-y:auto;"></div>

                        <!-- create the send message box with text input, anchored to the bottom of the server div -->
                        <div style="width: 100%; height: 50px; display: flex;">
                            <!-- <input type="text" id="message-input" style="width: calc(100% - 50px); height: 100%; float: left; padding: 10px; border: 0; border-radius: 15px; background-color: #2c2f33; color: #fff;">

                            <button id="message-send" style="width: 40px; height: 40px; float: left; margin-top:5px; margin-left:5px; padding: 10px; border: 0; border-radius: 50%; color: #fff;">
                                <img src="icons/send.svg" draggable="false" style="height:26px; margin-left:-4px; margin-top:-1px;"></img>
                            </button>  -->
                            <style>
                                .custom-form {
                                    display: flex;
                                    margin: 0 0.5rem;
                                    flex-direction: row;
                                    gap: 0.75rem;
                                    margin-bottom: 0.5rem;
                                    max-width: 60rem;
                                    margin-left: auto;
                                    margin-right: auto;
                                }
                            
                                .container {
                                    position: absolute;
                                    display: flex;
                                    height: 100%;
                                    flex-grow: 1;
                                    align-items: stretch;
                                    bottom:3px;
                                    background-color: transparent;
                                }
                            
                                .input-section {
                                    display: flex;
                                    flex-direction: column;
                                    width: 100%;
                                    padding: 0.625rem 0;
                                    flex-grow: 1;
                                    position: relative;
                                    border-width: 1px;
                                    border-color: rgba(32,33,35,.5);
                                    background-color: #202225;
                                    color: white;
                                    /* #border-radius: 1rem; */
                                    border-radius: .75rem;
                                    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1);
                                    --tw-shadow: 0 0 15px rgba(0,0,0,.1);
                                    --tw-shadow-colored: 0 0 15px var(--tw-shadow-color);
                                    box-shadow: 0 0 transparent,0 0 transparent,var(--tw-shadow);
                                    box-shadow: var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow);

                                }

                                .container {
                                    position: relative;
                                    display: flex;
                                    height: 100%;
                                    flex-direction: column-reverse; /* Reversing the order of items in the flex container to make textarea stick to bottom */
                                }

                                .input-container {
                                    width: 100%;
                                    display: flex;
                                    flex-direction: column-reverse;
                                }

                                .text-input {
                                    overflow: hidden;
                                    resize: none;
                                    margin: 0;
                                    width: 100%; /* Subtracting the space for the button and margins */
                                    resize: none;
                                    border: none;
                                    background-color: transparent;
                                    padding-right: 3rem;
                                    padding-left: 1rem;
                                    height: 24px;
                                    max-height: 50vh; /* 50% of the viewport height */
                                    overflow-y: auto; /* Enable scrolling when text goes beyond max height */
                                    font-size: 14px; /* Increasing font size */
                                    color: white; /* Making text color white */
                                    font-family: inherit; /* Changing the font */
                                    outline: none; /* Removes focus outline */
                                    flex-grow: 0.5;
                                }

                            
                                .submit-button {
                                    position: absolute;
                                    border:none;
                                    padding: 0.15rem;
                                    border-radius: 0.25rem;
                                    right: 0.7rem;
                                    transition: all 0.2s;
                                    background-color: #7B1FA2;
                                    color: white;
                                    opacity: 0.4;
                                }
                            
                                .submit-button.enabled {
                                    opacity: 1;
                                    cursor: pointer;
                                }
                            
                                .sendicon {
                                    height: 1rem;
                                    width: 1rem;
                                    margin: 0.25rem;
                                }
                            </style>
                            
                                <div class="container" role="presentation">
                                    <div class="input-container input-section">
                                        <textarea id="message-input" spellcheck="false" tabindex="0" data-id="root" placeholder="Send a message" class="text-input" oninput="enableButton()"></textarea>
                                        <button id="message-send" class="submit-button" disabled="">
                                            <span class="" data-state="closed">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none" class="sendicon" stroke-width="2">
                                                    <path d="M.5 1.163A1 1 0 0 1 1.97.28l12.868 6.837a1 1 0 0 1 0 1.766L1.969 15.72A1 1 0 0 1 .5 14.836V10.33a1 1 0 0 1 .816-.983L8.5 8 1.316 6.653A1 1 0 0 1 .5 5.67V1.163Z" fill="currentColor"></path>
                                                </svg>
                                            </span>
                                        </button>
                                    </div>
                            
                            <script>
                                // Enabling the send button when there's text in the textarea
                                function enableButton() {
                                    var textAreaValue = document.getElementById("message-input").value;
                                    var sendButton = document.getElementById("message-send");
                                    if(textAreaValue === "") {
                                        sendButton.classList.remove("enabled");
                                        sendButton.disabled = true;
                                    } else {
                                        sendButton.classList.add("enabled");
                                        sendButton.disabled = false;
                                    }
                                }
                            </script>
                            <script>
                                function autoGrow(element) {
                                    element.style.height = "5px";
                                    element.style.height = (element.scrollHeight)+"px";
                                }

                                document.getElementById('message-input').addEventListener('input', function () {
                                    autoGrow(this);
                                });

                            </script>
                                

                        </div>

                    </div>
                </div>
            </div>

        </div>

    </div>
                <div id="rightsidebar" style="width: 260px; height: 100%; float: right; background-color: #202225;">
                    <div id="right-sidebar" style="overflow-y: auto; width: 220px;"></div>
                </div>
                

            </div>

            <!-- Pop up a new module in front of everything, center of screen, with a slightly blurred background, with an input box at the top, and the returned list of users underneath inside of a scroll box.
            -->

            <div id="user-list" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
                <div id="user-search-box" style="width: 500px; height: 400px; background-color: #23272a; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 10px; overflow: hidden;">
                    <div style="width: 100%; height: 50px; background-color: #23272a; padding: 10px;">
                        <input placeholder="Find a new friend to chat with!" type="text" id="user-input" style="width: calc(100% - 65px); height: 100%; float: left; padding: 10px; border: 0; border-radius: 15px; background-color: #2c2f33; color: #fff;">
                        <!-- Make a circular search button with a magnifying glass img inside -->
                        <button id="user-search" style="width: 40px; height: 40px; float: left; margin-top:5px; margin-left:5px; padding: 10px; border: 0; border-radius: 50%; color: #fff;">
                            <img src="icons/search.svg" draggable="false" style="height:16px;"></img>
                        </button> 
                    </div>
                    <div id="returned-user-list" style="width: 100%; height: calc(100% - 70px); overflow-y: auto; background-color: #2c2f33;"></div>
                </div>
            </div>




        </div>

        <div id="login" style="display:none">

            <!-- Make the login screen -->
            <div id="loginScreen">
                <div id="loginScreenContent">
                    <div id="loginScreenTitle">
                        <img src="icons/logo.svg" draggable="false" style="height: 64px;margin-top: -25px;margin-left:-10px;"></img>
                    </div>
                    <div id="loginScreenLogin">
                        <div class="formModel">
                            <div class="_welcome_1xdze_133">
                                <div class="_title_1xdze_106">
                                    <img src="icons/wave.svg" draggable="false">Welcome back!
                                </div>
                                <div class="_subtitle_1xdze_150">Sign into gitchat
                                    <div>(gitchat.pages.dev)

                                    </div>
                                </div>
                            </div>

                            <div class="formModel1">

                                <!-- Make a login with Github button as primary, with Github's logo -->
                                <button id="primaryGithubButton" class="Button-sc-wdolxy-0 jbwUqj"><b>Login with Github</b>  
                                    <!-- move down one line, <br> doesn't work in buttons -->
                                    <br/>
                                    <img src="icons/fluidicon.png" draggable="false" style="height:24px"></img>
                                </button>

                                <!-- or, centered with a line -->
                                <div class="_or_1xdze_173">
                                    <div class="_line_1xdze_174"></div>
                                    <div class="_text_1xdze_175" style="text-align:center"><div style="color:grey; display:inline-block;"> ╶  </div> or <div style="color:grey; display:inline-block;">  ╴ </div></div>
                                    <div class="_line_1xdze_174"></div>
                                </div>


                                <div class="dt">
                                    <input placeholder="Enter your custom Git Server URL." class="InputBox-sc-13s1218-0 bEeAEn fbc-has-badge">
    
                                    <!-- put a right arrow button at the end of the input box -->
                                    <button><b>→</b></button>
                                </div>

                            </div>

                            </div>
                        <p>gitchat is a <i>git-based</i>, free, open-source, and modern web app that allows you to chat with your friends in real-time.</p>
                    </div>
                    </div>
                </div>
            </div>


            <!-- Position the loginScreenContent in a rounded box in the center of the screen -->
            <style>

                :root {
                    --primary-background: #24292e;
                    --secondary-background: #2f363d;

                    --scrollbar-track: #2f363d;
                    --scrollbar-thumb: #24292e;
                }

                #message-list {
                    /* Good looking scrollbar */
                    scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
                    scrollbar-width: thin;
                }

                .message {
                    /* background-color: #23272a; */
                }

                .message:hover {
                    background-color: #2f363d;
                }

#loginScreen {
    width: 100%;
    height: 100vh; /* Use full viewport height */
    display: flex;
    justify-content: center; /* Center horizontally */
    align-items: center;     /* Center vertically */
    user-select: none;
    background: url(icons/bg.webp);
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
}

#loginScreenContent {
    display: flex;
    flex-direction: column;
    align-items: center; /* Center content horizontally */
    background-color: rgba(36, 36, 36, 0.75);
    border: 2px solid rgba(128, 128, 128, 0.15);
    backdrop-filter: blur(20px);
    max-width: 360px;
    width: 100%;
    padding: 30px 25px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

#loginScreenTitle {
    display: flex;
    align-items: center;
    justify-content: center; /* Center the logo */
    width: 100%;
    margin-bottom: 20px; /* Space below the logo */
}

                /* Github login, with Github logo */
                #GithubLogin {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background-color: #24292e;
                    border: 1px solid #24292e;
                    border-radius: 6px;
                    color: #fff;
                    font-size: 14px;
                    font-weight: 600;
                    height: 40px;
                    line-height: 20px;
                    padding: 10px 16px;
                    text-align: center;
                    text-decoration: none;
                    width: 100%;
                    cursor: pointer;
                    transition: background-color .2s ease-in-out,border-color .2s ease-in-out,box-shadow .2s ease-in-out;
                }


                .formModel {
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }

                .formModel .formModel1 {
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }

                .formModel .formModel1 button {
                    padding: 8px;
                    background: var(--secondary-background);
                    /*margin-bottom: 15px;*/
                }

                ._welcome_1xdze_133 {
                    font-size: 20px;
                    font-weight: 600;
                    margin-bottom: 10px;
                }

                ._title_1xdze_106 {
                    display: flex;
                    align-items: center;
                    gap: 4px;
                }

                ._title_1xdze_106 img {
                    animation-name: _wave-animation_1xdze_1;
                    animation-duration: 2.5s;
                    animation-iteration-count: 1;
                    transform-origin: 70% 70%;
                    height: 28px;
                }

                ._subtitle_1xdze_150 {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    font-weight: 400;
                    font-size: 14px;
                }

                ._subtitle_1xdze_150 > div {
                    display: none;
                    margin-top: 1px;
                    font-size: 11px;
                    color: var(--secondary-foreground);
                }

                body {
                    margin: 0;
                    height: 100%;
                    /* font-family: var(--font),sans-serif; */
                    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, Helvetica Neue, Arial, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;

                    font-variant-ligatures: var(--ligatures);
                    -webkit-font-smoothing: antialiased;
                    -moz-osx-font-smoothing: grayscale;
                    caret-color: var(--accent);
                    color: white;
                    -webkit-tap-highlight-color: transparent;
                    -webkit-overflow-scrolling: touch;
                    -webkit-text-size-adjust: 100%;
                    overscroll-behavior: none;
                    scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
                }

                .jbwUqj {
                    z-index: 1;
                    display: flex;
                    -webkit-box-align: center;
                    align-items: center;
                    -webkit-box-pack: center;
                    justify-content: center;
                    flex-shrink: 0;
                    font-family: inherit;
                    transition: all 0.1s ease 0s;
                    border: none;
                    cursor: pointer;
                    border-radius: var(--border-radius);
                    height: 38px;
                    min-width: 96px;
                    padding: 2px 16px;
                    font-size: 0.8125rem;
                    font-weight: 500;
                    color: white;
                    background: var(--primary-background);
                }

                ._bottom_1xdze_189 {
                    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 14px;                
color:white;
}

    ._links_1xdze_195 {
        display: flex;
    align-items: center;
    gap: 15px;
    }

        ._links_1xdze_195 a {
            color: white;
            text-decoration: none;
        }

            ._links_1xdze_195 a:hover {
                text-decoration: underline;
            }

    ._links_1xdze_195 a:last-child {
        margin-left: auto;
    }

    ._links_1xdze_195 a:last-child:hover {
        text-decoration: none;
    }

    ._links_1xdze_195 a:last-child:hover svg {
        transform: translateX(5px);
    }

    ._links_1xdze_195 a:last-child svg {
        transition: transform 0.2s ease-in-out;
    }

    ._links_1xdze_195 a:last-child svg path {
        fill: white;
    }

    ._links_1xdze_195 a:last-child svg:hover path {
        fill: var(--primary-background);
    }

    ._links_1xdze_195 a:last-child svg:hover {
        background: white;
        border-radius: 50%;
    }

    ._or_1xdze_196 {
        color: white;
        font-size: 14px;
        font-weight: 500;
    }

    ._or_1xdze_196 svg {
        margin: 0 10px;
    }

    ._or_1xdze_196 svg path {
        fill: white;
    }

    ._or_1xdze_196 svg:hover path {
        fill: var(--primary-background);
    }

    .bEeAEn {
        width: 100%;
    padding: 11px 16px;
    font-size: 0.9375rem;
    font-family: inherit;
    font-weight: 500;
    border: none;
    border-radius: var(--border-radius);
    box-sizing: border-box;
    outline: none;
    transition: all 0.1s ease-in-out 0s;
    color: var(--secondary-foreground);
    background: var(--secondary-background);
    }


    .dt button {
        position: absolute;
        right: 25px;
        color:white;
        height:40px;
        border-color: transparent;
    }

    .dt button:hover {
        background-color: var(--primary-background);
        border-color: transparent;
        cursor: pointer;
    }


    #primaryGithubButton:hover {
        background-color: var(--primary-background);
        border-color: transparent;
        color: white;
    }


    @keyframes _wave-animation_1xdze_1 {
    0% {
        transform: rotate(0)
    }

    10% {
        transform: rotate(14deg)
    }

    20% {
        transform: rotate(-8deg)
    }

    30% {
        transform: rotate(14deg)
    }

    40% {
        transform: rotate(-4deg)
    }

    50% {
        transform: rotate(10deg)
    }

    60% {
        transform: rotate(0)
    }

    to {
        transform: rotate(0)
    }
}

    /* Hover over message-send button #7289da*/
    #message-send {
        background-color: #4e66ba;
    }

    #message-send:hover {
        background-color: #7289da;
        border-color: transparent;
        color: white;
        cursor: pointer;
    }

    /* Hover over message-send button #7289da*/
    #user-search {
        background-color: #4e66ba;
    }

    #user-search:hover {
        background-color: #7289da;
        border-color: transparent;
        color: white;
        cursor: pointer;
    }

    #logout {
        /* background-color: #4e66ba; */
    }

    #logout:hover {
        /* background-color: #7289da; */
        border-color: transparent;
        color: white;
        cursor: pointer;
    }

    #search-button {
        background-color: #4e66ba;
    }

    #search-button:hover {
        background-color: #7289da;
        border-color: transparent;
        color: white;
        cursor: pointer;
    }


    .message-content-text-image {
        max-width: fit-content;
        max-height: 400px;
        height: auto;
        width: 100%; 
        object-fit: contain;
    }

    .message-content-text-image:hover {
        cursor: pointer;
    }

    .message-content-text-image:hover img {
        filter: brightness(50%);
    }

    .message-content-text-image:hover img:hover {
        filter: brightness(100%);
    }

    .message-content-text-image img {
        border-radius: 10px;
    }

    .message-content-text-video {
        max-width: fit-content;
        max-height: 400px;
        width: 100%; 
    }

    .message-content-text-video:hover {
        cursor: pointer;
    }

    .message-content-text-video:hover video {
        filter: brightness(50%);
    }

    .message-content-text-video:hover video:hover {
        filter: brightness(100%);
    }

    .message-content-text-video video {
        border-radius: 10px;
    }

    video {
        max-width: 100%;
        max-height: 100%;
        border-radius: 10px;
    }

    /* Style friend, friend-avatar, and friend-name, like a user with a profile picture. */
    .potential-friend {
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #2c2f33;
    }

    .potential-friend:hover {
        background-color: #23272a;
        cursor: pointer;
    }

    .friend {
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 10px;
        color: #808080;
        position:relative;
        /* border-bottom: 1px solid #2c2f33; */
    }

    .friend:hover {
        background-color: #23272a;
        color:white;
        cursor: pointer;
    }

    .friend-avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        /* background-color: #7289da; */
        margin-right: 10px;
    }

    .friend-name {
        /* color: white; */
        font-size: 16px;
        font-weight: 500;
    }



            </style>


<style>
        .message-div {
            width: calc(100% - 20px);
            /* min-height: 60px; */
            /* background-color: #23272a; */
            padding: 10px;
            display: flex;
        }
        .message-div:hover {
            background-color: #2f363d;
        }
        .avatar-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }
        .message-content {
            width: calc(100% - 50px);
            padding-left: 15px;
            color: #fff;
            margin-top: -6px;
        }
        .username {
            font-size: 15px;
            font-weight: bold;
        }
        .username:hover {
            text-decoration: underline;
            cursor: pointer;
        }
        .message {
            font-size: 15px;
            margin-top:2px;
            overflow-wrap: anywhere;
            /* background-color: #23272a; */
        }
        .message:hover {
            background-color: #2f363d;
        }
        .popup-div {
            position: fixed;
            width: 300px;
            /* height: 200px; */
            background-color: #23272a;
            /* background-color: #2f3136; */
            color: #fff;
            /* padding: 10px; */
            display: none;
            align-items: center;
            border-radius: 10px;
            z-index: 999;
            justify-content: center;
            flex-direction: column;
            display:block;
        }
        .popup-avatar-img {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            position: relative;
            margin-top: -70px;
            border: #23272a;
            border-style: solid;
            border-width: 5px;
        }
        .popup-username {
            margin-top: 10px;
            font-size: 20px;
            font-weight: bold;
        }
        .popup-bio {
            margin-top: 10px;
            font-size: 15px;
        }

        .popup-header-img {
            position: relative;
            width: 100%;
            border-radius: 0;
            border: none;
            height: 100px;
            border-radius: 10px 10px 0px 0px;
        }


        #right-sidebar {
            background-color: #202225;
            color: #ffffff;
            width: 260px;
            height: 100vh;
            overflow-y: auto;
            padding: 20px;
        }

        .collaborator {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 3px;
            border-radius: 5px;
            user-select: none;
        }

        .collaborator:hover {
            background-color: #2f363d;
            cursor: pointer;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }

        .avatarside {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            pointer-events: none;
        }

        .username {
            flex-grow: 1;
            width: fit-content;
            display: inline-flex;
        }

        .status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #43b581; /* green for online, you can change this color based on the status */
            margin-left: 10px;
            margin-right: 10px;
            pointer-events: none;
        }


        .edit-remove-buttons {
        visibility: hidden;
        position: absolute;
        top: 5px;
        right: 10px;
        display: flex; /* New: align the buttons in a row */
        }

        .message-div:hover .edit-remove-buttons {
        visibility: visible;
        }

        .edit-remove-buttons button {
        background: none;
        border: none;
        color: #999;
        cursor: pointer;
        /* width: 25px;  */
        width: 32px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 5px;
        }

        .edit-remove-buttons button:hover {
        color: #555;
        background-color: rgba(255, 255, 255, 0.1); /* New: Slight highlight on hover */
        }

        .icon-button svg {
        fill: #fff; /* Change the color of the SVG */
        }

        .trash svg {
        fill: indianred; 
        }

        .edit-remove-buttons {
        position: absolute;
        top: -20px;
        right: 0;
        background-color: #2F3136;
        border-radius: 5px;
        padding: 1px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .icon-button {
        background: none;
        border: none;
        cursor: pointer;
        position: relative;
        }

        /* .icon-button::after {
        content: attr(title);
        position: absolute;
        bottom: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: #fff;
        padding: 2px 5px;
        border-radius: 5px;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease-in-out;
        }

        .icon-button:hover::after {
        opacity: 1;
        } */

        .button-wrapper {
            position: absolute;
            right: 5px;
            display: flex;
            gap: 5px;
        }

        .friend-button {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            opacity: 0.5;
            background: transparent;
            transition: opacity 0.2s;
        }

        .friend-button:hover {
            opacity: 1;
        }

        .check {
            color: gray;
        }

        .check:hover {
            color: green;
        }

        .cross {
            color: gray;
        }

        .cross:hover {
            color: indianred;
        }

        .media {
            max-width: 400px;
        }

</style>


        </div>

</body>



<script>

    // On the left side of the screen, similar to Discord, there is a list of servers.
    // Generate a list of servers, and add them to the left side of the screen.
    
    // Attach a click event to each server, so that when the user clicks on a server, the server is selected.
    
    // 
    // When a server is selected, the server's name is displayed in the top left corner of the screen.
    // The server's icon is displayed in the top left corner of the screen.
    // The server's description is displayed in the top left corner of the screen.
    // The server's owner is displayed in the top left corner of the screen.
    
    // Create a message object constructor.
    function Message(author, content) {
        this.author = author;
        this.content = content;
    }
    
    // Create a list of servers.
    var servers = {};
    
    // Display messages in the chat.
    // Create a function that will display messages in the chat.
    function displayMessage(message) {
  
        // Dynamically adjust the height of the message depending on how many lines the message takes up, which varies by browser size.
        // The height of the message is 40px, plus 20px for each line of text.

        var html = "";
            html += "<div class='message-div'>";
            html += "<img class='avatar-img' src='" + message.author.avatar + "' onclick='displayProfilePopup(\"" + message.author.avatar + "\", \"" + message.author.username + "\", \"" + message.author.bio + "\")'>";
            html += "<div class='message-content'>";
            html += "<div class='username' onclick='displayProfilePopup(\"" + message.author.avatar + "\", \"" + message.author.username + "\", \"" + message.author.bio + "\")'>" + message.author.username + "</div>";
        
        // Add date next to username in grey letters, smaller font size
        var date = new Date(message.author.date).getTime(); //Convert date to Epoch time

        html += "<div class='date' style='font-size: 13px; margin-top:2px; color: #706f6f; overflow-wrap: anywhere; display: inline-flex; margin-left: 10px; ' data-date='" + date + "'>"; //Save the date as an attribute
        html += getDate(message.author.date);
        html += "</div>";

        html += "<div style='font-size: 15px; margin-top:2px; color: #fff; overflow-wrap: anywhere;'>" + message.content + "</div>";
        html += "</div>";
        // Put a containr around the edit and remove buttons so that they can be positioned absolutely.
        html += "<div style='position: relative;margin-left: auto;'>";
        html += `
        <div class="edit-remove-buttons">
        <button class="icon-button" title="Edit Message" onclick="editMessage()">
        <svg width="15" height="20" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 980 980" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <path opacity="1.00" d=" M 795.88 3.02 C 807.51 -1.10 821.49 0.94 830.93 9.08 C 838.33 14.95 845.19 21.45 852.08 27.90 C 881.33 55.98 910.11 84.55 938.59 113.42 C 948.39 123.62 958.34 133.70 967.34 144.64 C 973.38 152.16 979.38 160.47 980.00 170.46 L 980.00 178.52 C 978.97 184.25 976.78 189.73 973.50 194.54 C 966.44 204.92 957.66 213.97 949.11 223.10 C 935.44 237.42 921.43 251.42 907.42 265.41 C 882.21 290.49 857.21 315.79 831.79 340.65 C 831.42 340.41 830.69 339.95 830.32 339.72 C 769.14 278.55 707.98 217.37 646.80 156.21 C 644.84 154.20 642.59 152.42 641.11 150.02 C 645.39 145.03 650.39 140.69 654.93 135.94 C 681.74 109.07 708.58 82.25 735.58 55.59 C 749.25 41.92 763.11 28.41 777.48 15.48 C 783.12 10.70 788.69 5.36 795.88 3.02 Z" />
        <path opacity="1.00" d=" M 596.90 193.91 C 597.79 193.16 598.61 192.09 599.85 191.96 C 609.54 200.97 618.62 210.65 628.08 219.91 C 681.59 273.41 735.08 326.93 788.60 380.41 C 790.22 381.53 789.84 383.32 788.32 384.32 C 632.67 539.67 477.58 695.58 321.36 850.36 C 291.67 879.34 262.48 908.85 231.83 936.82 C 228.47 940.00 223.65 940.30 219.43 941.60 C 179.79 950.80 139.88 958.76 99.98 966.70 C 73.31 971.27 47.00 978.13 20.04 980.98 C 10.53 982.57 0.35 975.51 0.00 965.54 L 0.00 960.46 C 6.10 925.17 13.09 890.04 20.10 854.92 C 23.52 841.08 25.48 826.92 28.91 813.09 C 32.69 794.05 37.07 775.13 41.24 756.18 C 42.38 749.97 47.86 746.23 51.77 741.78 C 103.82 688.16 156.63 635.30 209.23 582.23 C 311.85 479.18 414.76 376.43 517.57 273.57 C 543.77 246.78 570.53 220.53 596.90 193.91 Z" />
        </svg>
        </button>
        <button class="icon-button trash" title="Delete Message" onclick="removeMessage()">
        <svg width="20" height="20" fill="currentColor" class="bi bi-trash-fill"  viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">
        <path d="M767 336H233q-12 0-21 9t-9 21l38 505q1 13 12 21.5t30 8.5h434q18 0 29-8.5t13-21.5l38-505q0-12-9-21t-21-9zM344 841q-10 0-18-9t-8-21l-26-386q0-12 9-20.5t21-8.5 21 8.5 9 20.5l18 386q0 12-7.5 21t-18.5 9zm182-31q0 13-7.5 22t-18.5 9-18.5-9-7.5-22l-4-385q0-12 9-20.5t21-8.5 21 8.5 9 20.5zm156 1q0 12-8 21t-18 9q-11 0-18.5-9t-7.5-21l18-386q0-12 9-20.5t21-8.5 21 8.5 9 20.5zm101-605l-179-30q-12-2-15-15l-8-33q-4-20-14-26-6-3-22-3h-90q-16 0-23 3-10 6-13 26l-8 33q-2 13-15 15l-179 30q-19 3-31.5 14.5T173 249v28q0 9 6.5 15t15.5 6h610q9 0 15.5-6t6.5-15v-28q0-17-12.5-28.5T783 206z"/>
        </svg>
        </button>
        </div>
        `
        html += "</div>";
        html += "</div>";

        // Convert html to a DOM element.
        var div = document.createElement("div");
        div.innerHTML = html;

        binaryInsertMessage(div);

        // Keep the chat scrolled to the bottom.
        document.getElementById("message-list").scrollTop = document.getElementById("message-list").scrollHeight;

    }    

        
    function getDate(date) {
        if(date != null) {
            let today = new Date();
            let yesterday = new Date();
            yesterday.setDate(today.getDate() - 1);

            let messageDate = new Date(date);

            // The options for formatting the time.
            let timeOptions = {
                hour: 'numeric',
                minute: 'numeric',
                hour12: true
            };

            if (messageDate.toDateString() === today.toDateString()) {
                return "Today at " + messageDate.toLocaleTimeString('en-US', timeOptions);
            } else if (messageDate.toDateString() === yesterday.toDateString()) {
                return "Yesterday at " + messageDate.toLocaleTimeString('en-US', timeOptions);
            } else {
                return messageDate.toLocaleDateString('en-US', {
                    month: '2-digit',
                    day: '2-digit',
                    year: 'numeric'
                }) + ' ' + messageDate.toLocaleTimeString('en-US', timeOptions);
            }

        } else {
            var date = new Date();
            var timeString = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            return "Today at " + timeString;
        }

    }



    function binaryInsertMessage(newMessage) {
        var messageList = document.getElementById("message-list");
        
        if(!messageList.firstChild) {
            messageList.appendChild(newMessage);
            return;
        }

        var newMessageDate = parseInt(newMessage.getElementsByClassName("date")[0].getAttribute('data-date'));

        var currentMessage = messageList.firstChild;
        while(currentMessage) {
            var currentDate = parseInt(currentMessage.getElementsByClassName("date")[0].getAttribute('data-date'));

            if(currentDate >= newMessageDate) {
                break;
            }

            currentMessage = currentMessage.nextElementSibling;
        }

        if(currentMessage) {
            messageList.insertBefore(newMessage, currentMessage);
        } else {
            messageList.appendChild(newMessage);
        }
    }




    function displayMessageO(message, overrideMinHeight) {
            var html = "";
            html += "<div class='message-div'>";
            html += "<img class='avatar-img' src='" + message.author.avatar + "' onclick='displayProfilePopup(\"" + message.author.avatar + "\", \"" + message.author.username + "\", \"" + message.author.bio + "\")'>";
            html += "<div class='message-content'>";
            html += "<div class='username' onclick='displayProfilePopup(\"" + message.author.avatar + "\", \"" + message.author.username + "\", \"" + message.author.bio + "\")'>" + message.author.username + "</div>";
            html += "<div class='message'>" + message.content + "</div>";
            html += "</div>";
            html += "</div>";

            var div = document.createElement("div");
            div.innerHTML = html;
            document.getElementById("message-list").appendChild(div);
            document.getElementById("message-list").scrollTop = document.getElementById("message-list").scrollHeight;
        }    




        var lastClickedElement = null;

        function updatePopupPosition() {
            // Use getBoundingClientRect to get the position of the clicked element relative to the viewport
            var rect = lastClickedElement.getBoundingClientRect();

            var popup = document.getElementById("profile-popup");

            popup.style.left = (rect.right + 10) + 'px';
            popup.style.top = rect.top + 'px';

            // show on the left if there is not enough room on the right
            if(rect.right + 10 + 200 > window.innerWidth) {
                popup.style.left = (rect.left - 300 - 20) + 'px';
            }

            // make sure it doesnt go off screen on the bottom
            if(rect.top + popup.offsetHeight > window.innerHeight) {
                popup.style.top = (window.innerHeight - popup.offsetHeight) + 'px';
            }
        }

        function displayProfilePopup(avatar, username, bio) {

            if (document.getElementById("profile-popup") != null && lastClickedElement === event.target) {
                // A popup is already open and this is the same element that opened it
                document.getElementById("profile-popup").remove();
                window.removeEventListener('resize', updatePopupPosition);
                return;
            }
            lastClickedElement = event.target;

            // Delete any existing profile popups.
            var existingProfilePopups = document.getElementsByClassName("popup-div");
            for(var i = 0; i < existingProfilePopups.length; i++) {
                existingProfilePopups[i].remove();
            }

            var html = "<div class='popup-div' id='profile-popup'>";
            // set the img src to the color of the user's avatar from servers[serverID].collaboratorsDict[username].average_RGB
            //html += "<img class='popup-header-img' 
            html += "<div class='popup-header-img' style='background-color: rgb(114, 137, 218);'></div>"
            html += "<div style='padding: 15px; padding-bottom: 30px;'>";
            html += "<img class='popup-avatar-img' src='" + avatar + "'>";
            html += "<div class='popup-username'>" + username + "</div>";
            html += "<div class='popup-bio'>" + bio + "</div>";
            html += "</div>";
            html += "</div>";

            var div = document.createElement("div");
            div.innerHTML = html;
            document.body.appendChild(div.firstChild);

            var popup = document.getElementById("profile-popup");

            // position the popup where the user clicked.

            // popup.style.left = (event.clientX + 20) + 'px';
            // popup.style.top = event.clientY + 'px';

            
            // // instead of where the user clicked, just put it to the right of the element that was clicked, and not their click position.
            // popup.style.left = (event.target.offsetLeft + event.target.offsetWidth + 10) + 'px';
            // popup.style.top = event.target.offsetTop + 'px';

            // // show on the left if there is not enough room on the right
            // if(event.target.offsetLeft + event.target.offsetWidth + 10 + 200 > window.innerWidth) {
            //     popup.style.left = (event.target.offsetLeft - 300 - 20) + 'px';
            // }


            // var rect = event.target.getBoundingClientRect();

            // popup.style.left = (rect.right + 10) + 'px';
            // popup.style.top = rect.top + 'px';

            // // show on the left if there is not enough room on the right
            // if(rect.right + 10 + 200 > window.innerWidth) {
            //     popup.style.left = (rect.left - 300 - 20) + 'px';
            // }
            updatePopupPosition()
            window.addEventListener('resize', updatePopupPosition);


            window.onclick = function(event) {
                // Delete this event if no profile popup is open.
                if(document.getElementById("profile-popup") == null) {
                    window.onclick = null;
                    window.removeEventListener('resize', updatePopupPosition);
                    return;
                }
                if (!event.target.matches('.avatar-img') && !event.target.matches('.username') && !event.target.matches('.collaborator') ) {
                    var popup = document.getElementById("profile-popup");
                    if (event.target != popup && !popup.contains(event.target)) {
                        window.removeEventListener('resize', updatePopupPosition);
                        popup.remove();
                    }
                }
            }

        }


    async function fixLink(content, message) {

        // If user's message is a link, embed the link as an image, or as a video if the link is a video.
        if(content.startsWith("https://") || content.startsWith("http://")) {
            // Check for image links.
            if(content.endsWith(".png") || content.endsWith(".jpg") || content.endsWith(".jpeg") || content.endsWith(".gif")) {
                message.content = "<div class='media'><img src='" + content + "' style='max-width: fit-content; height: 400px; width: 100%'></div>";
            }
            // Check for video links.
            else if(content.endsWith(".mp4") || content.endsWith(".webm") || content.endsWith(".ogg")) {
                message.content = "<div class='media'><video src='" + content + "' style='max-width: fit-content; height: 400px; width: 100%' controls></video></div>";
            }
            // Check for audio links.
            else if(content.endsWith(".mp3") || content.endsWith(".wav") || content.endsWith(".ogg")) {
                message.content = "<div class='media'><audio src='" + content + "' style='width: 100%' controls></audio></div>";
            }
            // Check for YouTube links, if the link contains "youtu" and has a "v=" parameter.
            else if(content.includes("youtu") && content.includes("v=")) {
                // Get the video ID from the link.
                var videoID = content.split("v=")[1];

                // Check if the video ID has an ampersand.
                if(videoID.includes("&")) {
                    // Remove the ampersand and everything after it.
                    videoID = videoID.substring(0, videoID.indexOf("&"));
                }

                // Embed the YouTube video. No border please.
                message.content = "<div class='media'><iframe src='https://www.youtube.com/embed/" + videoID + "' style='max-width: fit-content; max-height: 400px;height: 225px;width: 100%; border:none;' scrolling='no' style='overflow:hidden' allowfullscreen></iframe></div>";
                
                var avatar = localStorage.getItem("avatar");
                var username = localStorage.getItem("username");
                var message = new Message({username: username, avatar: avatar}, message.content);
                //displayMessageO(message, 200);
                //document.getElementById("message-input").value = "";
                //sendChat(document.getElementById("true-server-name").innerHTML, content)
                //return

            } else if(content.includes("tenor.com/view/")) {

                await fetchGif(message,content); // You call the function with the content

            }
        }

        if (content.startsWith("data:image")) {
            message.content = "<div class='media'><img src='" + content + "' class='message-content-text-image'></div>";
        } else if (content.startsWith("data:video")) {
            message.content = "<div class='media'><video src='" + content + "' class='message-content-text-video' controls></video></div>";
        } else if(content.startsWith("data:audio")) {
            message.content = "<div class='media'><audio src='" + content + "' style='width: 100%' controls></audio></div>";
        }else if (content.startsWith("data:")) {
            message.content += "<div class='media'><a href='" + content + "' class='message-content-text-file'>" + name + "</a></div>";
        }  

    }

    // Assuming we're in an async function
    async function fetchGif(message, content) {
        // Get the GIF ID from the link.
        var gifID = content.split("tenor.com/view/")[1];
        // the id is what comes after the last dash
        console.log(gifID);
        gifID = gifID.split("-").pop();
        console.log(gifID);
        //const gifId = '19478029';  // extract the id from the provided URL
        const apiKey = 'AIzaSyDIV59A9Wp9TEz3NSObVpYJ7uAEcuPxYoQ';  // replace with your actual Tenor API key
        try {
            // block on this network request
            const response = await fetch(`https://tenor.googleapis.com/v2/posts?key=${apiKey}&ids=${gifID}&media_filter=loopedmp4`);
            const json = await response.json();
            const gifUrl = json.results[0].media_formats.loopedmp4.url;
            message.content = "<div class='media'><video src='" + gifUrl + "' style='max-width: 400px; width:100%' autoplay loop></video></div>";
            console.log(message.content);
            console.log(gifUrl);  // you can now use this URL in an img or iframe tag
        } catch (err) {
            console.error(err);
        }
    }



    // Allow user to send messages.
    // Create a function that will send messages.
    async function sendMessage() {
        // Get the message content.
        var content = document.getElementById("message-input").value;

        // Check if the message content is empty.
        if (content == "") {
            // Do not send the message.
            return;
        }

        // Get user's avatar.
        var avatar = localStorage.getItem("avatar");

        // Get user's username.
        var username = localStorage.getItem("username");

        // Create a message object.
        var message = new Message({username: username, avatar: avatar}, content);
    
        await fixLink(content, message);

        // Display the message.
        displayMessage(message);
    
        // Clear the message input.
        document.getElementById("message-input").value = "";

        // Send it to the server.
        var name = document.getElementById("true-server-name").innerHTML;
        sendChat(name, content) 

    }

    function sendMessageO(content, type, name) {

        // Check if the message content is empty.
        if (content == "") {
            // Do not send the message.
            return;
        }

        // Get user's avatar.
        var avatar = localStorage.getItem("avatar");

        // Get user's username.
        var username = localStorage.getItem("username");

        // Create a message object.
        var message = new Message({username: username, avatar: avatar}, content);

        if (type.startsWith("image/")) {
            message.content = "<div class='media'><img src='" + content + "' class='message-content-text-image'></div>";
        } else if (type.startsWith("video/")) {
            message.content = "<div class='media'><video src='" + content + "' class='message-content-text-video' controls></video></div>";
        } else if(type.startsWith("audio/")) {
            message.content = "<div class='media'><audio src='" + content + "' style='width: 100%' controls></audio></div>";
        }else {
            message.content = "<div class='media'><a href='" + content + "' class='message-content-text-file'>" + name + "</a></div>";
        }

        // Display the message.
        displayMessage(message);
    
        // Clear the message input.
        document.getElementById("message-input").value = "";

        // Send it to the server.
        var name = document.getElementById("true-server-name").innerHTML;
        sendChat(name, content) 
    }

    
    async function sendMessageO2(overload, username, avatar, date) {
        var content = overload;
        if (content == "") {
            // Do not send the message.
            return;
        }
        // console.log(content);
        var message = new Message({username: username, avatar: avatar, date: date}, content);
        await fixLink(content, message);
        displayMessage(message);
    }

    // Attach a click event to the send message button.
    //document.getElementById("message-send").addEventListener("click", sendMessage);

    // Attach a keypress event to the message input.
    document.getElementById("message-input").addEventListener("keypress", function(event) {
        // Check if the user pressed the enter key, but not also the shift key.
        if (event.key == "Enter" && !event.shiftKey) {
            event.preventDefault();
            // Send the message.
            sendMessage();
        } else {
            // Append a new line to the message input.
            //document.getElementById("message-input").value += "\n";
        }
    });

    // Also attach a click event to the send message button.
    document.getElementById("message-send").addEventListener("click", sendMessage);



    // Log user in via Github App Integration with JavaScript. Do NOT use Node.js or other server-side languages.


    // Show login button instead of main page if the user is not logged in.
    // Check if the user is logged in.
    if (localStorage.getItem("access-token") == null) {
        // Show the login button.
        document.getElementById("login").style.display = "block";
        document.getElementById("nonLogin").style.display = "none";
    } else {
        // Show the main page.
        document.getElementById("login").style.display = "none";
        document.getElementById("nonLogin").style.display = "block";
    }

// document.getElementById("login").style.display = "none";
//         document.getElementById("nonLogin").style.display = "block";
    

    // Log user out.
    // Create a function that will log the user out.
    function logOut() {
        // Remove the access token from local storage.
        localStorage.removeItem("access-token");

        // Reload the page.
        location.reload();
    }

    // Attach a click event to the logout button.
    //document.getElementById("logout").addEventListener("click", logOut);

    // Attack click event to login button.
    document.getElementById("primaryGithubButton").addEventListener("click", function() {
        // Redirect the user to the Github login page.
        console.log("Redirecting to Github login page...")
        location.href = "https://gitchat.ryanhardestylewis.workers.dev";
    });

    // Attack click event to logout button.
    document.getElementById("logout").addEventListener("click", function() {
        // Redirect the user to the Github login page.
        console.log("Redirecting to Github login page...")
        logOut();
    });
    

    
    </script>


<script>

    // ------------ //
    // LOGIN SCRIPT //
    // ------------ //

    const WORKER_URL = "https://gitchat.ryanhardestylewis.workers.dev";
    const code = new URL(location.href).searchParams.get("code");

    if (code) {
      login(code);
    }

    async function login(code) {
      // remove ?code=... from URL
      const path =
        location.pathname +
        location.search.replace(/\bcode=\w+/, "").replace(/\?$/, "");
      history.pushState({}, "", path);

      document.body.dataset.state = "loading";

      try {
        const response = await fetch(WORKER_URL, {
          method: "POST",
          mode: "cors",
          headers: {
            "content-type": "application/json"
          },
          body: JSON.stringify({ code })
        });

        const result = await response.json();

        if (result.error) {
          return alert(JSON.stringify(result, null, 2));
        }

        // token can now be used to send authenticated requests against https://api.github.com
        const getUserResponse = await fetch("https://api.github.com/user", {
          headers: {
            accept: "application/vnd.github.v3+json",
            authorization: `token ${result.token}`
          }
        });
        const { login } = await getUserResponse.json();

        // Store the access token in local storage.
        localStorage.setItem("access-token", result.token);

        document.body.dataset.state = "signed-in";
        location.reload();
      } catch (error) {
        alert(error);
        location.reload();
      }
    }
  </script>


<script>

    // Now, we can use the access token to make authenticated requests against the GitHub API.
    // Get the list of repositories.
    // Create a function that will get the list of repositories.
    function getRepos() {
        accessToken = localStorage.getItem("access-token");
        // Create a new request.
        var request = new XMLHttpRequest();
        // Open the request.
        request.open("GET", "https://api.github.com/user/repos", true);
        // Set the request headers.
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + accessToken);
        // Send the request.
        request.send();
        // When the request is loaded.
        request.onload = function() {
            // Check if the request was successful.
            if (request.status == 200) {
                // Parse the response.
                var response = JSON.parse(request.responseText);
                // Loop through the response.
                for (var i = 0; i < response.length; i++) {

                    // Create a variable that will hold the HTML code.
                    var html = "";
                    // Add the repository like a server.
                    html += "<div class='server'>";
                    html += "<div class='server-icon' style='background-image: url(" + response[i].owner.avatar_url + ");'></div>";
                    html += "<div class='server-name'>" + response[i].name + "</div>";
                    html += "</div>";


                    // Add the HTML code to the page.
                    //document.getElementById("server-list").innerHTML += html;

                    // Instead of .innerHTML, we should use .appendChild() to add the HTML code to the page.
                    // This is because .innerHTML can be used to inject malicious code into the page.
                    document.getElementById("server-list").appendChild(html);
                }
            }
        }
    }

    // Get the list of repositories.
    //getRepos();


    // Allow drag and drop.

    function dropHandler(ev) {
  console.log('File(s) dropped');

  // Prevent default behavior (Prevent file from being opened)
  ev.preventDefault();

  if (ev.dataTransfer.items) {
    // Use DataTransferItemList interface to access the file(s)
    [...ev.dataTransfer.items].forEach((item, i) => {
      // If dropped items aren't files, reject them
      if (item.kind === 'file') {
        const file = item.getAsFile();
        console.log(`… file[${i}].name = ${file.name}`);

        // Send the file locally to the message-list div.
        var reader = new FileReader();
        reader.onload = function(e) {

            sendMessageO(e.target.result, file.type, file.name)

        }
        // Read in asynchronusly using a worker thread. 
        reader.readAsDataURL(file);

      }
    });
  } else {
    // Use DataTransfer interface to access the file(s)
    [...ev.dataTransfer.files].forEach((file, i) => {
      console.log(`…non file[${i}].name = ${file.name}`);
    });
  }
}

function dragOverHandler(ev) {
  console.log('File(s) in drop zone');

  // Prevent default behavior (Prevent file from being opened)
  ev.preventDefault();
}

    // Attack click event to login button.
    document.getElementById("search-button").addEventListener("click", function() {
        // Get text in the search bar.
        var searchText = document.getElementById("search").value;
        getNewFriends(searchText);
    });

    // Attach a keypress event to the message input.
    document.getElementById("search").addEventListener("keypress", function(event) {
        if (event.key == "Enter" && !event.shiftKey) {
            var searchText = document.getElementById("search").value;
            getNewFriends(searchText);
        }
    });

    document.getElementById("user-search").addEventListener("click", function() {
        // Get text in the search bar.
        var searchText = document.getElementById("user-input").value;

        getNewFriends(searchText);

    });

    document.getElementById("user-input").addEventListener("keypress", function(event) {
        if (event.key == "Enter" && !event.shiftKey) {
            var searchText = document.getElementById("user-input").value;
            getNewFriends(searchText);
        }
    });

    function getNewFriends(searchText) {

        if(searchText == "") {
            return;
        }

        var initialOpenBox = document.getElementById("user-list").style.display == "none";


        // Clear the list of user
        document.getElementById("returned-user-list").innerHTML = "";


        // Create a new request.
        var request = new XMLHttpRequest();

        // Search for users.
        request.open("GET", "https://api.github.com/search/users?q=" + searchText, true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send();

        // When the request is loaded.
        request.onload = function() {
            // Check if the request was successful.
            if (request.status == 200) {
                // Parse the response.
                var response = JSON.parse(request.responseText);
                // Loop through the response.
                for (var i = 0; i < response.items.length; i++) {
                    // Create a variable that will hold the HTML code.
                    var html = "";
                    // Add the user like a friend.
                    html += "<div class='potential-friend'>";
                    html += "<img class='friend-avatar' src='" + response.items[i].avatar_url + "'></img>";
                    html += "<div class='friend-name'>" + response.items[i].login + "</div>";
                    // Also store each friend's ID in a hidden div.
                    html += "<div class='friend-id' style='display: none;'>" + response.items[i].id + "</div>";
                    html += "</div>";

                    // Add the HTML code to the page.
                    document.getElementById("returned-user-list").innerHTML += html;
                }
                
                // Add a click event that passes the user's name to the addFriend function.
                var friends = document.getElementsByClassName("potential-friend");
                for (var i = 0; i < friends.length; i++) {
                    friends[i].addEventListener("click", function() {
                        addFriend(this.getElementsByClassName("friend-name")[0].innerHTML, this.getElementsByClassName("friend-id")[0].innerHTML);
                    });
                }


                // Pop up a new module in front of everything, with a slightly blurred background, with an input box at the top, and the returned list of users underneath in a scroll box
                // When a user is clicked, the module disappears, and the user's name is added to the top of the chat list, and the chat list is scrolled to the top.
                // When the module is closed, the chat list is scrolled to the top.
                document.getElementById("user-list").style.display = "block";
                
                var afterOpenBox = document.getElementById("user-list").style.display == "block";

                if(initialOpenBox == afterOpenBox) {
                    document.addEventListener('click', function handleClickOutsideBox(event) {
                        const box = document.getElementById('user-search-box');
                        if (!box.contains(event.target)) {
                            document.getElementById("user-input").value = "";
                            document.getElementById("search").value = "";
                            document.getElementById("user-list").style.display = "none";
                            document.removeEventListener('click', handleClickOutsideBox);
                        }
                    });
                }

            }
        }
    }

    function openChat(name) {

        // clear the message-list div
        document.getElementById("message-list").innerHTML = "";

        // Close the user search box.
        document.getElementById("user-list").style.display = "none";
        // Clear the search bar.
        document.getElementById("user-input").value = "";
        document.getElementById("search").value = "";

        // Highlight the selected friend.
        var friends = document.getElementsByClassName("friend");
        for (var i = 0; i < friends.length; i++) {
            friends[i].style.backgroundColor = "";
            friends[i].style.color = ""
        }
        document.getElementById("gitchat-" + name).parentElement.style.backgroundColor = "rgb(114 137 218 / 15%)"
        document.getElementById("gitchat-" + name).parentElement.style.color = "white"

        // Click the friend.
       // document.getElementById("gitchat-" + name).click();



    }

    function addFriend(name, id) {

        // Remove all click events with the addFriend function.
        var friends = document.getElementsByClassName("friend");
        for (var i = 0; i < friends.length; i++) {
            friends[i].removeEventListener("click", function() {
                addFriend(this.getElementsByClassName("friend-name")[0].innerHTML);
            });
        }
        
        // Check if the friend already exists.
        if (document.getElementById("gitchat-" + name) != null) {
            // Open the friend's chat.
            openChat(name);
            return;
        }

        // Create a new request.
        var request = new XMLHttpRequest();

        // Create a new friend repository.
        request.open("POST", "https://api.github.com/user/repos", true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send(JSON.stringify({
            "name": "gitchat-" + name,
            "private": true,
            // Also set homepage to gitchat.pages.dev/ {user ID}
            "homepage": "https://gitchat.pages.dev/" + id // Putting this ID on the repo makes it much easier to grab user profile pictures 
        }));

        // When the request is loaded.
        request.onload = function() {
            // Check if the request was successful.
            if (request.status == 201) {
                // Parse the response.
                var response = JSON.parse(request.responseText);
                // Add the friend to the list.
                addFriendToList(name, "https://avatars.githubusercontent.com/u/" + id + "?v=4");

                // Invite the friend to the repository.
                inviteCollaborator(response.owner.login, response.name, name);

                // Make first chat.txt
                makeChat(response);

            }
        }

        document.getElementById("user-input").value = "";
        document.getElementById("search").value = "";
        document.getElementById("user-list").style.display = "none";

    }

    // From the confirmed repository creation response, make the first chat.txt and upload it to the repository.
    function makeChat(response) {

        // Create a new request.
        var request = new XMLHttpRequest();

        // Create a new file.
        request.open("PUT", "https://api.github.com/repos/" + response.owner.login + "/" + response.name + "/contents/chat.txt", true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send(JSON.stringify({
            "message": "Initial commit",
            "content": btoa(""),
            "sha": response.default_branch,
        }));

        // When the request is loaded.
        request.onload = function() {
            // Check if the request was successful.
            if (request.status == 201) {
                // Parse the response.
                var response1 = JSON.parse(request.responseText);

                console.log(response1)

                // share the repository with the friend
                // shareChat(response.name.split("-")[1]);

            }
        }

    }

    function checkInvitations() {
        // A function that lists repository invitations for the authenticated user,
        // and if there are any that begin with "gitchat-", make a new friend called
        // "Message Requests" and add a submenu item for each invitation.

        // Create a new request.
        var request = new XMLHttpRequest();

        // Create a new file.
        request.open("GET", "https://api.github.com/user/repository_invitations", true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send();

        // When the request is loaded.
        request.onload = function() {
            if(request.status == 200) {
                // Parse the response.
                var response = JSON.parse(request.responseText);

                console.log(response)

                // Iterate through the invitations, checking if any of them begin with "gitchat-".
                // for(var i = 0; i < response.length; i++) {
                //     // If the invitation does not begin with "gitchat-", remove it from the array.
                //     if(!response[i].repository.full_name.startsWith("gitchat-")) {
                //         response.splice(i, 1);
                //     }
                // }

                // If there are any invitations with 'gitchat-', add a friend called "Message Requests" and add a submenu item for each invitation.
                // if(response.length > 0) {
                //     // Add a friend called "Message Requests".
                //     addFriendToList("Message Requests (" + response.length + ")", "https://avatars.githubusercontent.com/u/0?v=4", false);
                //     // Append a submenu to the friend.
                //     var friend = document.getElementById("gitchat-Message Requests");
                //     var submenu = document.createElement("div");
                //     submenu.className = "submenu";
                //     submenu.style.display = "none";
                //     // On click, display block, and on click again, display none.
                //     // Remove any existing click events.
                //     friend.addEventListener("click", function() {
                //         if(submenu.style.display == "none") {
                //             submenu.style.display = "block";
                //         } else {
                //             submenu.style.display = "none";
                //         }
                //     });
                //     friend.appendChild(submenu);

                //     // Add a submenu item for each invitation.
                //     for(var i = 0; i < response.length; i++) {
                //         // Add a submenu item for each invitation.
                //         addSubmenuItemToList("Message Requests", response[i], "https://avatars.githubusercontent.com/u/0?v=4");
                //     }
                // }
                if(response.length > 0) {
                    // Add a friend called "Message Requests".
                    addFriendToList("Message Requests (" + response.length + ")", "https://avatars.githubusercontent.com/u/0?v=4", false, true, "#171a1c");
                    var friend = document.getElementById("gitchat-Message Requests" + " (" + response.length + ")");
                    // change the id to just "gitchat-Message Requests"
                    friend.id = "gitchat-Message Requests";

                    // Create the submenu element.
                    var submenu = document.createElement("div");
                    submenu.className = "submenu";
                    submenu.style.display = "none";
                    // friend.appendChild(submenu);
                    //ayo = friend.parentNode.parentNode.appendChild(submenu);
                    // insert submenu directly after the friend element
                    // friend.parentNode.parentNode.insertBefore(submenu, friend.parentNode.parentNode.nextSibling);
                    friend.parentNode.insertAdjacentElement('afterend', submenu);



                    // Add a submenu item for each invitation.
                    for(var i = 0; i < response.length; i++) {
                        // Create a div for each friend in the submenu
                        var subFriend = document.createElement("div");
                        subFriend.className = "friend";
                        subFriend.style.backgroundColor = "#171a1c"; // Darkened color for submenu friends

                        // Get the name from repository.name without the "gitchat-" prefix
                        var name = response[i].repository.name.split("-")[1];
                        var owner = response[i].repository.owner.login;
                        var avatar = response[i].repository.owner.avatar_url;

                        // // Fill in the friend's info
                        // subFriend.innerHTML = "<img class='friend-avatar' src='" + avatar + "'>"
                        //                     + "<div class='friend-name'>" + owner + "</div>"
                        //                     + "<div class='true-friend-name' style='display:none'>" + owner + "</div>";

                        var inviteID = response[i].id;

                        // Fill in the friend's info
                        subFriend.innerHTML = "<img class='friend-avatar' src='" + avatar + "'>"
                                            + "<div class='friend-name' id='gitchat-" + inviteID + "'>" + owner + "</div>"
                                            + "<div class='true-friend-name' style='display:none'>" + owner + "</div>"
                                            + "<div class='button-wrapper'>"
                                            + "<button class='friend-button check'>&#10004;</button>"
                                            + "<button class='friend-button cross'>&#10006;</button>"
                                            + "</div>";

                        // Event listeners for the buttons
                        subFriend.getElementsByClassName("check")[0].addEventListener("click", function(event) {
                            event.stopPropagation(); // prevent the click event from bubbling up to the subFriend click event
                            // Do something when the check button is clicked
                            console.log('Check button clicked');
                            parseInvitation(inviteID, true, owner, avatar);
                        });

                        subFriend.getElementsByClassName("cross")[0].addEventListener("click", function(event) {
                            event.stopPropagation(); // prevent the click event from bubbling up to the subFriend click event
                            // Do something when the cross button is clicked
                            console.log('Cross button clicked');
                            parseInvitation(inviteID, false, owner, avatar);
                        });


                        
                        // Add a click event to the subFriend
                        subFriend.addEventListener("click", function() {
                            // openChat(this.getElementsByClassName("true-friend-name")[0].innerHTML);
                            console.log("hi")
                        });

                        // Add the friend to the submenu
                        submenu.appendChild(subFriend);
                    }
                }

                
            }

        }
    }

    function parseInvitation(id, accept, name, avatar) {
        
        // Create a new request.
        var request = new XMLHttpRequest();

        // Create a new file.
        request.open(accept ? "PATCH" : "DELETE", "https://api.github.com/user/repository_invitations/" + id, true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send();
        
        // When the request is loaded.
        // When the request is loaded.
        request.onload = function() {
            // Check if the request was successful.
            if (request.status == 204) {
                // Parse the response.
                

                removeFriendFromList(id);

                // subtract 1 from the number of invitations in the Message Requests friend
                var friend = document.getElementById("gitchat-Message Requests");
                var numInvites = parseInt(friend.innerHTML.split("(")[1].split(")")[0]);
                friend.innerHTML = "Message Requests (" + (numInvites - 1) + ")";
                if(numInvites - 1 == 0) {
                    // friend.style.display = "none";
                    removeFriendFromList("Message Requests");
                }

                if(accept) {
                    // Add the friend to the list.
                    // var response = JSON.parse(request.responseText);
                    addFriendToList(name, avatar);
                }

            }
        }

    }

    function inviteCollaborator(owner, repo, username) {
        // Create a new request.
        var request = new XMLHttpRequest();

        // URL for the GitHub API
        var url = "https://api.github.com/repos/" + owner + "/" + repo + "/collaborators/" + username;

        // Create a new file.
        request.open("PUT", url, true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));

        // Send the request
        request.send();

        // When the request is loaded.
        request.onload = function() {
            // Check if the request was successful.
            if (request.status == 201 || request.status == 204) {
                // Parse the response.
                var response = JSON.parse(request.responseText);

                console.log(response)
            } else {
                // Handle error.
                console.log('Error: ' + request.status);
            }
        }
    }


    // function shareChat(name) {

    //     // Add a collaborator to the repository.
    //     var request = new XMLHttpRequest();

    //     // Create a new file.
    //     request.open("PUT", "https://api.github.com/repos/" + servers[name].owner.login + "/gitchat-" + name + "/collaborators/" + name, true);
    //     request.setRequestHeader("Accept", "application/vnd.github.v3+json");
    //     request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
    //     request.send();

    //     // When the request is loaded.
    //     request.onload = function() {
    //         // Check if the request was successful.
    //         if (request.status == 200) {
    //             // Parse the response.
    //             var response = JSON.parse(request.responseText);

    //             console.log(response)

    //         }
    //     }

    // }

    function deleteChat(name) {
        // Create a new request.
        var request = new XMLHttpRequest();

        // Create a new file.
        request.open("DELETE", "https://api.github.com/repos/" + servers[name].owner.login + "/gitchat-" + name, true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send();

        // When the request is loaded.
        request.onload = function() {
            // Check if the request was successful.
            if (request.status == 204) {
                // Parse the response.
                var response = JSON.parse(request.responseText);

                // Remove the friend from the list.
                removeFriendFromList(name);

            }
        }
    }


    function removeFriendFromList(name) {
        // Remove the friend from the list.
        document.getElementById("gitchat-" + name).parentNode.remove();
    }

    // Send chat message, by pushing the text to the chat.txt file.
    function sendChat(name, message) {

        // Create a new request.
        var request = new XMLHttpRequest();

        // Create a new file.
        request.open("PUT", "https://api.github.com/repos/" + servers[name].owner.login + "/gitchat-" + name + "/contents/chat.txt", true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send(JSON.stringify({
            "message": "commit",
            "content": btoa(message),
            "sha": document.getElementById("lastSHA").innerHTML
        }));

        // When the request is loaded.
        request.onload = function() {
            // Check if the request was successful.
            if (request.status == 200) {
                // Parse the response.
                var response = JSON.parse(request.responseText);

                // Set hidden SHA to the new SHA.
                document.getElementById("lastSHA").innerHTML = response.content.sha;

                console.log(response)

            }
        }

    }

    // Get the chat messages from the chat.txt file.
    // by getting the last 10 commits, and getting the those commits' contents of the chat.txt file.
    function getChat(name) {

        console.log("Chat is gtting")

        if(document.getElementById("message-list").innerHTML != "") {
            return;
        }

        fixedname = name;
        if(name == localStorage.getItem("username")) {
            fixedname = servers[name].owner.login;
        }

        console.log(fixedname)
        var userAvatar = null;
        if(servers[name].collaboratorsDict[fixedname] != null) {
            userAvatar = servers[name].collaboratorsDict[fixedname].avatar_url;
        } else {
            // use the repository homepage to get the user's avatar
            userAvatar = "https://avatars.githubusercontent.com/u/" + servers[name].homepage.split("/")[3] + "?v=4";
        }
        document.getElementById("user-avatar").src = userAvatar;

        document.getElementById("server-name").innerHTML = fixedname;
        document.getElementById("true-server-name").innerHTML = name;

        console.log("Getting chat for " + name)

        populateCollaboratorList(servers[name].collaboratorsDict);

        // Create a new request.
        var request = new XMLHttpRequest();

        // Create a new file.
        request.open("GET", "https://api.github.com/repos/" + servers[name].owner.login + "/gitchat-" + name + "/commits", true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send();

        // When the request is loaded.
        request.onload = function() {
            console.log(request)
            // Check if the request was successful.
            if(request.status == 200) {
                // Parse the response.
                var response = JSON.parse(request.responseText);
                console.log("BELOW IS RESPONSE")
                console.log(response)

                console.log(response)

                // Get the minimum of 10 commits, or the number of commits.
                var min = Math.min(10, response.length);

                // Get the last 10 commits.
                for (var i = 0; i < min; i++) {
                    // Store the last date in servers[name].lastDate
                    servers[name].lastDate = response[i].commit.author.date;
                    // Get the chat.txt file from the commit.
                    getChatFile(response[i], name, i);
                }


                // https://raw.githubusercontent.com/ {username} /gitchat- {otheruser} / {sha} / chat.txt

            }
        }

    }

    // Get the chat.txt file from the commit.
    function getChatFile(commitInfo, name, i) {

        // Create a new request.
        var request = new XMLHttpRequest();

        // Create a new file.
        request.open("GET", "https://api.github.com/repos/" + servers[name].owner.login + "/gitchat-" + name + "/contents/chat.txt?ref=" + commitInfo.sha, true);
        //request.open("GET", "https://raw.githubusercontent.com/" + localStorage.getItem("username") + "/gitchat-" + name + "/" + sha + "/chat.txt", true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send();
        // When the request is loaded.
        request.onload = async function() {
            // Check if the request was successful.
            if(request.status == 200) {
                // Parse the response.
                var response = JSON.parse(request.responseText);

                console.log(response)

                if(i == 0)
                    document.getElementById("lastSHA").innerHTML = response.sha;

                // Add the message to the chat.
                //addMessageToChat(response.content, name);
                // check if content exists
                // if not, hit getUserContent

                // convert response.content to text from base64
                var text = atob(response.content);

                if (!text) {
                    try {
                        text = await getUserContent(commitInfo, name, response);
                        console.log(text)
                    } catch (error) {
                        console.log('Failed to get user content: ' + error.message);
                        return;
                    }
                } 

                sendMessageO2(text, commitInfo.author.login, commitInfo.author.avatar_url, commitInfo.commit.author.date)

            }
        }


    }

    // getUserContent
    // A function that hits a URL similar to https://raw.githubusercontent.com/gitchat/gitchat-ryanhlewis/main/chat.txt?token=GHSAT0AAAAAACE7WTKSNNUNNKNFUH5LVEROZGFS3UQ
    // but with the correct ref and token
    function getUserContent(commitInfo, name, origresponse) {
    return new Promise((resolve, reject) => {
        var request = new XMLHttpRequest();
        
        // Updated URL to match the request example
        var url = `https://api.github.com/repos/${servers[name].owner.login}/gitchat-${name}/git/blobs/${origresponse.sha}`;

        request.open("GET", url, true);
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));

        request.onload = function() {
            if (request.status == 200) {
                var response = JSON.parse(request.responseText);
                var content = atob(response.content); // decode from Base64
                resolve(content); // Resolve with the decoded content
            } else {
                reject(new Error('Failed to load blob: ' + request.statusText));
            }
        };

        request.onerror = function() {
            reject(new Error('Network error'));
        };

        request.send();
    });
}


    // Add a friend to the list.
    function addFriendToList(name, avatar, addClickEvent = true, submenu = false, bgcolor="") {
        console.log("Adding friend to list")
        console.log(name)
        // Check if the "friend" is ourself, if so, get the owner name and avatar of the repo.
        var fixedname = name;
        var fixedavatar = avatar;
        //console.log("Checking if " + name + " is the owner of " + servers[name].name)
        if (name == localStorage.getItem("username")) {
            console.log("Owner of " + servers[name].name + " is " + servers[name].owner.login)
            fixedname = servers[name].owner.login;
            fixedavatar = servers[name].owner.avatar_url;
        } 

        // Create a variable that will hold the HTML code.
        var html = "";
        // Add the user like a friend.
        // html += "<div class='friend'>";
        html += "<div class='friend'" + (bgcolor != "" ? "style='background-color:" + bgcolor + "'>" : ">");
        html += "<img class='friend-avatar' src='" + fixedavatar + "'></img>";
        html += "<div id='gitchat-" + name + "' class='friend-name'>" + fixedname + "</div>";
        html += "<div class='true-friend-name' style='display:none'>" + name + "</div>";
        html += "</div>";

        // Convert to node
        var node = document.createElement("div");
        node.innerHTML = html;
        var friend = node.firstChild;
        
        // Add the HTML code to the page.
        //document.getElementById("server-list").innerHTML += html;
        document.getElementById("server-list").appendChild(friend);

        // Add a click event that passes the user's name to the addFriend function.
        if(addClickEvent) {
            // var friends = document.getElementsByClassName("friend");
            // for (var i = 0; i < friends.length; i++) {
            //     friends[i].addEventListener("click", function() {
            //         event.stopPropagation();  // stop event from bubbling up
            //         openChat(this.getElementsByClassName("true-friend-name")[0].innerHTML);
            //     });
            // }
            console.log("Adding click event to friend " + name)
            friend.addEventListener("click", function() {
                console.trace()
                console.log("Friend clicked")
                event.stopPropagation();  // stop event from bubbling up
                var otherServer = document.getElementById("server-name").innerHTML
                var initialFriendBool = otherServer == this.getElementsByClassName("friend-name")[0].innerHTML
                if(initialFriendBool) {
                    console.log("Clicking on same friend")
                    return
                }
                openChat(this.getElementsByClassName("true-friend-name")[0].innerHTML);
                getChat(this.getElementsByClassName("true-friend-name")[0].innerHTML);
            });


        }   


        if(submenu) {
            var friend = document.getElementById("gitchat-" + name);
            console.log("HEY")
            console.log(friend)
            friend.parentElement.addEventListener("click", function() {
                var submenu = document.getElementsByClassName("submenu")[0];
                if(submenu.style.display == "none") {
                    submenu.style.display = "block";
                } else {
                    submenu.style.display = "none";
                }
            });

            // move to the top of the server list
            var serverList = document.getElementById("server-list");
            serverList.insertBefore(friend.parentNode, serverList.firstChild);

            // replace the friend-avatar image with an svg
            var avatar = friend.parentNode.querySelector(".friend-avatar");
            avatar.outerHTML = `
                <svg class="friend-avatar" width="20px" height="20px" style="    border-radius: 0%;
    width: 20px;
    height: 20px;
    fill: grey;
    margin-left: 5px;
    margin-right: 13px;" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1.5 6.5C1.5 3.46243 3.96243 1 7 1C10.0376 1 12.5 3.46243 12.5 6.5C12.5 9.53757 10.0376 12 7 12C3.96243 12 1.5 9.53757 1.5 6.5Z"></path>
                    <path d="M14.4999 6.5C14.4999 8.00034 14.0593 9.39779 13.3005 10.57C14.2774 11.4585 15.5754 12 16.9999 12C20.0375 12 22.4999 9.53757 22.4999 6.5C22.4999 3.46243 20.0375 1 16.9999 1C15.5754 1 14.2774 1.54153 13.3005 2.42996C14.0593 3.60221 14.4999 4.99966 14.4999 6.5Z"></path>
                    <path d="M0 18C0 15.7909 1.79086 14 4 14H10C12.2091 14 14 15.7909 14 18V22C14 22.5523 13.5523 23 13 23H1C0.447716 23 0 22.5523 0 22V18Z"></path>
                    <path d="M16 18V23H23C23.5522 23 24 22.5523 24 22V18C24 15.7909 22.2091 14 20 14H14.4722C15.4222 15.0615 16 16.4633 16 18Z"></path>
                </svg>`;
        }


    }

    
    function getAverageRGB(imgSrc) {

        // Create image element, given imgEl is a URL
        var imgEl = new Image();
        imgEl.crossOrigin = '';
        // set a source width and height, or it will default to 0x0
        imgEl.width = 420;
        imgEl.height = 420;
        imgEl.src = imgSrc;

        var blockSize = 5, // only visit every 5 pixels
            defaultRGB = {r:0,g:0,b:0}, // for non-supporting envs
            canvas = document.createElement('canvas'),
            context = canvas.getContext && canvas.getContext('2d'),
            data, width, height,
            i = -4,
            length,
            rgb = {r:0,g:0,b:0},
            count = 0;

        if (!context) {
            return defaultRGB;
        }

        height = canvas.height = imgEl.naturalHeight || imgEl.offsetHeight || imgEl.height;
        width = canvas.width = imgEl.naturalWidth || imgEl.offsetWidth || imgEl.width;

        context.drawImage(imgEl, 0, 0);

        try {
            data = context.getImageData(0, 0, width, height);
        } catch(e) {
            console.log(e)
            /* security error, img on diff domain */
            return defaultRGB;
        }

        length = data.data.length;

        while ( (i += blockSize * 4) < length ) {
            ++count;
            rgb.r += data.data[i];
            rgb.g += data.data[i+1];
            rgb.b += data.data[i+2];
        }

        // ~~ used to floor values
        rgb.r = ~~(rgb.r/count);
        rgb.g = ~~(rgb.g/count);
        rgb.b = ~~(rgb.b/count);

        return rgb;

    }

    function getCollaborators(repoName, owner, ownerAvatar) {
        var request = new XMLHttpRequest();

        var serverName = 'gitchat-' + repoName

        request.open("GET", `https://api.github.com/repos/${owner}/${serverName}/collaborators`, true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send();

        request.onload = function() {
            if (request.status == 200) {
                var response = JSON.parse(request.responseText);
                var collaborators = response.map(function(collaborator) {
                    return collaborator.login;
                });

                console.log(collaborators)

                servers[repoName].collaborators = collaborators;
                
                // Also add the owner to the list of collaborators.
                // servers[repoName].collaborators.push(owner);

                // Keep a real list of collaborators, with dict sorted by login
                servers[repoName].collaboratorsDict = {}
                // Use the original response, get each collaborator.login, set as dict key, and also get avatar_url 
                for(var i = 0; i < response.length; i++) {
                    servers[repoName].collaboratorsDict[response[i].login] = {}
                    servers[repoName].collaboratorsDict[response[i].login].avatar_url = response[i].avatar_url;
                    servers[repoName].collaboratorsDict[response[i].login].average_RGB = getAverageRGB(response[i].avatar_url);
                }

                // Add the owner to the dict.
                // servers[repoName].collaboratorsDict[owner] = {}
                // servers[repoName].collaboratorsDict[owner].avatar_url = ownerAvatar;

            }
        };
    }


    function getFriends() {
    // Store servers globally
    var token = localStorage.getItem("access-token");

    // Fetch all repositories with pagination
    function fetchRepos(page, callback) {
        var request = new XMLHttpRequest();
        request.open("GET", `https://api.github.com/user/repos?per_page=100&page=${page}`, true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + token);

        request.onload = function () {
            if (request.status === 200) {
                var response = JSON.parse(request.responseText);
                if (response.length > 0) {
                    callback(response, true); // More pages to fetch
                } else {
                    callback([], false); // No more pages
                }
            } else {
                console.error("Failed to fetch repositories:", request.status, request.statusText);
                callback([], false); // End on error
            }
        };

        request.send();
    }

    // Process repositories and handle pagination
    function processRepos(page) {
        fetchRepos(page, function (repos, hasMore) {
            for (var i = 0; i < repos.length; i++) {
                if (repos[i].name.startsWith("gitchat-")) {
                    console.log(repos[i].name + " is a friend.");

                    // Remove the "gitchat-" prefix
                    var fixedname = repos[i].name.split("-")[1];

                    servers[fixedname] = repos[i];
                    getCollaborators(
                        fixedname,
                        repos[i].owner.login,
                        repos[i].owner.avatar_url
                    );

                    console.log(servers);

                    // Process the homepage if available
                    if (repos[i].homepage) {
                        // var friendID = repos[i].homepage.substring(22);
                        var friendID = repos[i].homepage.split("/")[3];
                        var avatar = `https://avatars.githubusercontent.com/u/${friendID}?v=4`;
                        addFriendToList(fixedname, avatar);
                    }
                }
            }

            if (hasMore) {
                // Fetch the next page
                processRepos(page + 1);
            } else {
                console.log("Finished processing all repositories.");
            }
        });
    }

    // Start processing from page 1
    processRepos(1);
}


    // When the page is loaded, get user info latest.
    function getUserInfo() {

        // Open a request to Github to fetch user info.
        var request = new XMLHttpRequest();
        request.open("GET", "https://api.github.com/user", true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send();

        // When the request is loaded.
        request.onload = function() {
            // Check if the request was successful.
            if (request.status == 200) {
                // Parse the response.
                var response = JSON.parse(request.responseText);
                console.log(response)
                // Set the username.
                localStorage.setItem("username", response.login);
                // Set the user's avatar.
                localStorage.setItem("avatar", response.avatar_url);

                // Set the user's avatar.
                document.getElementById("avatar").style.backgroundImage = "url(" + response.avatar_url + ")";
                // Set the username.
                document.getElementById("username").innerHTML = response.login;

                // Get the user's friends.
                getFriends();

                
                checkInvitations();
                
            }
        }

    }

   getUserInfo()


   
    
</script>

<script>

    // Get the chat messages from the chat.txt file.
    // by getting the last 10 commits, and getting the those commits' contents of the chat.txt file.
    async function getChatPing(name) {

        console.log("Chat is being pinged")
        // sleep for 5 seconds
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        await sleep(5000);


        fixedname = name;
        if(name == localStorage.getItem("username")) {
            fixedname = servers[name].owner.login;
        }

        document.getElementById("server-name").innerHTML = fixedname;
        document.getElementById("true-server-name").innerHTML = name;

        console.log("Getting chat for " + name)

        // Create a new request.
        var request = new XMLHttpRequest();

        // Create a new file.
        request.open("GET", "https://api.github.com/repos/" + servers[name].owner.login + "/gitchat-" + name + "/commits", true);
        request.setRequestHeader("Accept", "application/vnd.github.v3+json");
        request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
        request.send();

        // When the request is loaded.
        request.onload = function() {
            console.log(request)
            // Check if the request was successful.
            if(request.status == 200) {
                // Sleep for 5 seconds
                //await sleep(5000);
                console.log("Got chat ping")
                // Parse the response.
                var response = JSON.parse(request.responseText);

                console.log(response)

                // Parse the incoming commit data
                //const commit = JSON.parse(e.data);
                var commit = response[0];

                console.log(commit)

                // Get the server name
                var name = document.getElementsByClassName("true-friend-name")[0].innerHTML;

                // Check if the commit date is later than the last saved message date
                var commitDate = new Date(commit.commit.committer.date);
                var lastDate = new Date(servers[name].lastDate);

                console.log("The date is " + commitDate + " and the last date is " + lastDate)

                if (commitDate > lastDate) {
                    console.log("The date is later than the last date")
                    // Update the lastDate in the servers dictionary
                    servers[name].lastDate = commit.commit.committer.date;

                    // Get the chat file for the new commit
                    getChatFile(commit, name, 0);  // I'm not sure what the third argument to getChatFile is supposed to be
                }

                // https://raw.githubusercontent.com/ {username} /gitchat- {otheruser} / {sha} / chat.txt

            }
        }

    }

function parseSSEResponse(e) {
    console.log("Got SSE message");
    console.log(e.data);

    try {
        const message = JSON.parse(e.data);

        if (message.type === "LIST") {
            // If a 'LIST' type query, return the list of collaborators
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "https://api.gitchat.pages.dev/webhook/reply", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            // strip gitchat- from the server name
            // var serverName = message.server.substring(10);
            var serverName = message.server.split("-")[1];
            console.log("Sending list response for " + serverName)
            console.log(servers[serverName].collaborators)
            xhr.send(JSON.stringify({
                username: localStorage.getItem("username"),
                persons: servers[serverName].collaborators,
                sha: message.sha,
                timestamp: message.timestamp
            }));
        } else {
            // Existing handling of commit messages
            var name = document.getElementsByClassName("true-friend-name")[0].innerHTML;

            //var commitDate = new Date(message.head_commit.timestamp);
            var commitDate = new Date(message.timestamp);
            var lastDate = new Date(servers[name].lastDate);

            //var sha = message.head_commit.id;
            var sha = message.sha;

            if (commitDate > lastDate) {
                // commitInfo = {
                //     "author": {
                //         "login": message.head_commit.author.username,
                //         "avatar_url": message.head_commit.author.avatar_url
                //     },
                //     "commit": {
                //         "author": {
                //             "date": message.head_commit.timestamp
                //         }
                //     },
                //     "sha": message.head_commit.id
                // }
                commitInfo = {
                    "author": {
                        "login": message.username,
                        "avatar_url": servers[name].collaboratorsDict[message.username].avatar_url
                    },
                    "commit": {
                        "author": {
                            "date": message.timestamp
                        }
                    },
                    "sha": message.sha
                }

                getChatFile(commitInfo, name, 0);
            }
        }

    } catch (e) {
        console.log(e)
        console.log("Error parsing JSON")
    }
}


function makeSSE() {
    var source = new EventSource('https://api.gitchat.pages.dev/connect?q=' + localStorage.getItem("username"), { withCredentials: true });

    source.addEventListener('message', function(e) {
        parseSSEResponse(e)
    }, false)

    source.addEventListener('open', function(e) {
    console.log("Connected to SSE")
    }, false)

    source.addEventListener('error', function(e) {
    if (e.eventPhase == EventSource.CLOSED)
        source.close()
    if (e.target.readyState == EventSource.CLOSED) {
        console.log("Disconnected from SSE")
        source.close()
        source = null
        //makeSSE()
        // try again after 10 seconds
        setTimeout(makeSSE, 10000)
    }
    else if (e.target.readyState == EventSource.CONNECTING) {
        console.log("Connecting to SSE")
    }
    }, false)
}

// SSE for message reload, status ping, and friend requests.
if (!!window.EventSource) {
    // If the person has a username, make an SSE connection.
    if(localStorage.getItem("username") != null)
        makeSSE()
  } else {
    console.log("Your browser doesn't support SSE")
}



function populateCollaboratorList(collaborators) {
    console.log("Populating collaborator list")

    var sidebar = document.getElementById("right-sidebar");

    // Clear the sidebar before populating.
    sidebar.innerHTML = "";

    // Add each collaborator to the sidebar.
    Object.keys(collaborators).forEach(function(username) {
        var collaborator = collaborators[username];

        var item = document.createElement("div");
        item.className = "collaborator";

        // Call displayProfilePopup("https://avatars.githubusercontent.com/u/104056425?v=4", "FerdinandFX", "undefined"
        item.addEventListener("click", function() {
            displayProfilePopup(collaborator.avatar_url, username, "undefined");
        });

        var img = document.createElement("img");
        img.src = collaborator.avatar_url;
        img.className = "avatarside";

        var span = document.createElement("span");
        span.className = "sideusername";
        span.textContent = username;

        var status = document.createElement("span");
        status.className = "status";
        // You can set status.textContent here if needed

        item.appendChild(img);
        item.appendChild(span);
        item.appendChild(status);

        sidebar.appendChild(item);
    });
}


// var request = new XMLHttpRequest();
// request.open("GET", "https://api.github.com/repos/gitchat/gitchat-ryanhlewis/git/blobs/83259866ee52c81c3df8463d7d1468620bfd6a10", true);
// request.setRequestHeader("Authorization", "token " + localStorage.getItem("access-token"));
// request.send();
// request.onload = function() {
//     if(request.status == 200) {
//         var response = JSON.parse(request.responseText);
//         var content = atob(response.content); // decode from Base64
//         console.log(content);
//     }
// }







</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">

<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

<script>
  if (window.innerWidth < 600) {
    document.getElementById("app").classList.add("mobileapp");
    document.getElementById("header").style.width = "100%";
    document.getElementById("chatwindow").style.width = "100%";

    // Wrap leftsidebar, centersidebar, rightsidebar in    <div class="swiper">
    //   <div class="swiper-wrapper">
    var leftsidebar = document.getElementById("leftsidebar");
    var centersidebar = document.getElementById("centersidebar");
    var rightsidebar = document.getElementById("rightsidebar");

    // attach menu class to leftsider
    leftsidebar.classList.add("left-menu");
    centersidebar.classList.add("content")
    rightsidebar.classList.add("right-menu")

    leftsidebar.classList.add("swiper-slide")
    centersidebar.classList.add("swiper-slide")
    rightsidebar.classList.add("swiper-slide")


    var leftsidebarParent = leftsidebar.parentNode;
    var centersidebarParent = centersidebar.parentNode;
    var rightsidebarParent = rightsidebar.parentNode;
    var swiper = document.createElement("div");
    swiper.className = "swiper";
    swiper.classList.add("origSlider");
    var swiperWrapper = document.createElement("div");
    swiperWrapper.className = "swiper-wrapper";
    swiper.appendChild(swiperWrapper);
    leftsidebarParent.replaceChild(swiper, leftsidebar);
    swiperWrapper.appendChild(leftsidebar);
    centersidebarParent.replaceChild(swiper, centersidebar);
    swiperWrapper.appendChild(centersidebar);
    rightsidebarParent.replaceChild(swiper, rightsidebar);
    swiperWrapper.appendChild(rightsidebar);

    // make a menu-button           <div class="menu-button">
        //     <div class="bar"></div>
        //     <div class="bar"></div>
        //     <div class="bar"></div>
        //   </div>
        // to the left of #user-avatar parent
    var userAvatar = document.getElementById("user-avatar");
    var menuButton = document.createElement("div");
    menuButton.className = "menu-button";
    var bar1 = document.createElement("div");
    bar1.className = "bar";
    var bar2 = document.createElement("div");
    bar2.className = "bar";
    var bar3 = document.createElement("div");
    bar3.className = "bar";

    // make another parent div for the bars
    var barParent = document.createElement("div");
    // set margin-top: -5px 
    barParent.style.marginTop = "-7px";

    barParent.appendChild(bar1);
    barParent.appendChild(bar2);
    barParent.appendChild(bar3);

    menuButton.appendChild(barParent);

    userAvatar.parentNode.insertBefore(menuButton, userAvatar);

    



    console.log("bummer")
    var menuButton = document.querySelector('.menu-button');
    var rightMenuButton = document.querySelector('#show-users-button');
    // remove the existing onclick from rightMenuButton
    rightMenuButton.onclick = null;
    var openMenu = function () {
      swiper.slidePrev();
    };
    var openRightMenu = function () {
      swiper.slideNext();
    };

    var swiper = new Swiper('.origSlider', {
      slidesPerView: 'auto',
      initialSlide: 1,
      resistanceRatio: 0,
      slideToClickedSlide: true,
      centeredSlides: true,
      centeredSlidesBounds: true,
      on: {
        slideChangeTransitionStart: function () {
          var slider = this;
          console.log(slider.activeIndex)

          if (slider.activeIndex === 0) {
            menuButton.classList.add('cross');
            menuButton.removeEventListener('click', openMenu, true);
          } else if (slider.activeIndex === 2) {
            rightMenuButton.classList.add('cross');
            rightMenuButton.removeEventListener('click', openRightMenu, true);
          } else {
            menuButton.classList.remove('cross');
            rightMenuButton.classList.remove('cross');
          }
        },
        slideChangeTransitionEnd: function () {
          var slider = this;
          if (slider.activeIndex === 1) {
            menuButton.addEventListener('click', openMenu, true);
            rightMenuButton.addEventListener('click', openRightMenu, true);
          }
        },
      },
    });
  }

  // Place a swiper around #chatwindow
//   <div class="swiper mySwiper">
//     <div class="swiper-wrapper">
//       <div id="chatwindow" class="swiper-slide">
//         </div>
//     <div class="swiper-scrollbar"></div>
//   </div>
var messagelist1 = document.getElementById("chatwindow");
messagelist1.style.position = "relative";
messagelist1.style.height = "100%";


var messagelist = document.getElementById("message-list");
messagelist.style.overflowY = "";
messagelist.style.height = "auto";

    var chatwindow = document.getElementById("message-list");
    chatwindow.classList.add("swiper-slide")
    chatwindow.style.display = "block"
    chatwindow.style.backgroundColor = "transparent"

    var chatwindowParent = chatwindow.parentNode;
    var swiper1 = document.createElement("div");
    swiper1.className = "swiper mySwiper";
    swiper1.style.height = "calc(100% - 115px)"
    var swiperWrapper = document.createElement("div");
    swiperWrapper.className = "swiper-wrapper";
    swiper1.appendChild(swiperWrapper);
    chatwindowParent.replaceChild(swiper1, chatwindow);
    swiperWrapper.appendChild(chatwindow);
    var swiperScrollbar = document.createElement("div");
    swiperScrollbar.className = "swiper-scrollbar";
    swiper1.appendChild(swiperScrollbar);

      // Combined Swiper
      var swiper1 = new Swiper(".mySwiper", {
      direction: "vertical",
      slidesPerView: "auto",
      freeMode: true,
      scrollbar: {
        el: ".swiper-scrollbar",
      },
      mousewheel: true,
    });

// Same thing for server-list
var serverlist = document.getElementById("server-list");
serverlist.classList.add("swiper-slide")
serverlist.style.display = "block"
serverlist.style.overflowY = ""
serverlist.style.backgroundColor = "transparent"

var serverlistParent = serverlist.parentNode;
var swiper2 = document.createElement("div");
swiper2.className = "swiper mySwiper1";

swiper2.style.height = "calc(100% - 115px)"
swiper2.style.marginTop = "50px"

var swiperWrapper = document.createElement("div");
swiperWrapper.className = "swiper-wrapper";
swiper2.appendChild(swiperWrapper);
serverlistParent.replaceChild(swiper2, serverlist);
swiperWrapper.appendChild(serverlist);
var swiperScrollbar = document.createElement("div");
swiperScrollbar.className = "swiper-scrollbar";

swiper2.appendChild(swiperScrollbar);

  // Combined Swiper
  var swiper2 = new Swiper(".mySwiper1", {
  direction: "vertical",
  slidesPerView: "auto",
  freeMode: true,
  scrollbar: {
    el: ".swiper-scrollbar",
  },
  mousewheel: true,
});

// same thing for right-sidebar
var rightSidebar = document.getElementById("right-sidebar");
rightSidebar.classList.add("swiper-slide")
rightSidebar.style.display = "block"
rightSidebar.style.overflowY = "unset"
rightSidebar.style.overflowX = "unset"
rightSidebar.style.overflow = "unset"
rightSidebar.style.backgroundColor = "transparent"

var rightSidebarParent = rightSidebar.parentNode;
var swiper3 = document.createElement("div");
swiper3.className = "swiper mySwiper2";
var swiperWrapper = document.createElement("div");
swiperWrapper.className = "swiper-wrapper";
swiper3.appendChild(swiperWrapper);
rightSidebarParent.replaceChild(swiper3, rightSidebar);
swiperWrapper.appendChild(rightSidebar);
var swiperScrollbar = document.createElement("div");
swiperScrollbar.className = "swiper-scrollbar";

swiper3.appendChild(swiperScrollbar);

  // Combined Swiper
  var swiper3 = new Swiper(".mySwiper2", {
  direction: "vertical",
  slidesPerView: "auto",
  freeMode: true,
  scrollbar: {
    el: ".swiper-scrollbar",
  },
  mousewheel: true,
});


</script>


<style>


    .swiper {
        width: 100%;
        height: 100%;
      }

        
      .swiper-slide {
        font-size: 18px;
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .left-menu {
        min-width: 100px;
        width: 70%;
        max-width: 320px;
        background-color: #2c8dfb;
        color: #fff;
      }

      .right-menu {
        background-color: #2c8dfb;
        color: #fff;
        min-width: 100px;
        width: 70%;
        max-width: 320px;
      }
  
      .content {
        width: 100%;
      }
  

    .mobileapp {
        /* width: 300%; */
        /* height: 100vh; */
        /* display: flex; */
    }

    .mobileapp .mobileready {
        width:100%;height: 100%;
    }

    .mobileapp #right-sidebar {
        height: calc(100% - 40px);
    }

    .mobileapp #leftsidebar, .mobileapp #rightsidebar {
        width:fit-content;
    }


    .mobileapp .swiper {
    width: 100%;
    height: 100%;
    }

    .mobileapp .swiper-slide {
    font-size: 18px;
    background: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    }

    .mobileapp #message-list {
        flex-shrink: unset;
        height: unset;
    }

.mobileapp .left-menu, .mobileapp .right-menu {
  background-color: #2c8dfb;
  color: #fff;
  min-width: 100px;
  width: 70%;
  max-width: 320px;
}

.mobileapp .menu-button, .mobileapp .right-menu-button {
    position: relative;
    width: 30px;
    height: 20px;
    margin-right: 5px;
    padding: 5px;
    float: left;
    background-color: unset;
}


.mobileapp .right-menu-button {
  right: 0px;
}


.mobileapp .menu-button:hover .bar, .mobileapp .right-menu-button:hover .bar {
    background-color: #fff;
}

.mobileapp .menu-button, .mobileapp .right-menu-button {
    cursor: pointer;
}

.mobileapp .bar {
    position: relative;
    display: block;
    width: 30px;
    height: 5px;
    margin: 5px auto;
    background-color: #808080;
    border-radius: 10px;
    -webkit-transition: 0.3s;
    transition: 0.3s;
}

/* ... Additional styles from the reference code for buttons ... */

.mobileapp #leftsidebar, .mobileapp #rightsidebar {
  width: fit-content;
}


</style>

<style>
    /* SVG Style */
    #install-banner {
      display: none;
      background-color: #007bff;
      color: white;
      padding: 10px;
      position: fixed;
      width: 100%;
      top: 0;
      left: 0;
      font-size: 14px;
      text-align: center;
      z-index: 1000;
    }
    #install-banner button {
      background-color: white;
      color: #007bff;
      border: none;
      padding: 5px 10px;
      margin-left: 10px;
      cursor: pointer;
    }
    #install-banner button.close {
      background-color: transparent;
      color: white;
    }


</style>

</html>